<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malik Service Center - Admin Dashboard</title>
    
    <!-- Icons & Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* ==================== VARIABLES ==================== */
        :root {
            --primary: #1e3a8a;
            --primary-light: #3b82f6;
            --secondary: #10b981;
            --accent: #f59e0b;
            --danger: #ef4444;
            --warning: #fbbf24;
            --dark-bg: #0f172a;
            --dark-card: #1e293b;
            --light-bg: #f1f5f9;
            --light-card: #ffffff;
            --text-main: #334155;
            --text-light: #64748b;
            --border: #e2e8f0;
            --sidebar-width: 260px;
            --header-height: 70px;
            --radius: 10px;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        .dark-mode {
            --light-bg: #0f172a;
            --light-card: #1e293b;
            --text-main: #f1f5f9;
            --text-light: #94a3b8;
            --border: #334155;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--light-bg);
            color: var(--text-main);
            line-height: 1.6;
            min-height: 100vh;
            transition: var(--transition);
        }

        /* ==================== LAYOUT ==================== */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* ==================== SIDEBAR ==================== */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--light-card);
            border-right: 1px solid var(--border);
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
        }

        .brand {
            padding: 0 20px 30px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .brand-logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .brand-text {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-menu {
            flex: 1;
            overflow-y: auto;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--text-light);
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary);
            border-left-color: var(--primary);
        }

        .nav-item i {
            width: 24px;
            margin-right: 12px;
            font-size: 1.2rem;
        }

        .nav-label {
            font-weight: 500;
        }

        .nav-badge {
            margin-left: auto;
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }

        .user-profile {
            padding: 20px;
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }

        .user-info h4 {
            font-size: 0.9rem;
            margin-bottom: 2px;
        }

        .user-info p {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* ==================== MAIN CONTENT ==================== */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 20px;
        }

        .header {
            height: var(--header-height);
            background: var(--light-card);
            border-radius: var(--radius);
            padding: 0 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        .header-left h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-main);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .header-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ==================== DASHBOARD ==================== */
        .section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ==================== STATS CARDS ==================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--light-card);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-size: 1.5rem;
        }

        .stat-content {
            flex: 1;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .stat-change {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 20px;
            margin-top: 5px;
            display: inline-block;
        }

        .stat-change.positive {
            background: rgba(16, 185, 129, 0.1);
            color: var(--secondary);
        }

        .stat-change.negative {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        /* ==================== TABLES ==================== */
        .table-container {
            background: var(--light-card);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .table-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h3 {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .table-actions {
            display: flex;
            gap: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: rgba(59, 130, 246, 0.05);
        }

        th {
            padding: 15px 20px;
            text-align: left;
            font-weight: 600;
            color: var(--text-main);
            border-bottom: 1px solid var(--border);
        }

        td {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
        }

        tr:hover {
            background: rgba(59, 130, 246, 0.02);
        }

        /* ==================== FORMS ==================== */
        .form-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .form-modal.active {
            display: flex;
        }

        .form-container {
            background: var(--light-card);
            border-radius: var(--radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        }

        .form-header {
            padding: 25px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .form-header h3 {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .form-body {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--light-bg);
            color: var(--text-main);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-footer {
            padding: 20px 25px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* ==================== BUTTONS ==================== */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-main);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            border-radius: 50%;
        }

        /* ==================== BADGES ==================== */
        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--secondary);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--accent);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .badge-info {
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary);
        }

        /* ==================== UTILITIES ==================== */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .d-flex { display: flex; }
        .d-none { display: none; }
        .align-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }
        .gap-3 { gap: 1.5rem; }
        .w-100 { width: 100%; }
        .cursor-pointer { cursor: pointer; }

        /* ==================== LOADER & TOAST ==================== */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .dark-mode .loader {
            background: rgba(15, 23, 42, 0.95);
        }

        .loader.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            background: var(--light-card);
            border-radius: var(--radius);
            padding: 15px 20px;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 9998;
            transform: translateX(400px);
            transition: var(--transition);
            max-width: 400px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .toast-success .toast-icon {
            background: var(--secondary);
            color: white;
        }

        .toast-error .toast-icon {
            background: var(--danger);
            color: white;
        }

        .toast-warning .toast-icon {
            background: var(--accent);
            color: white;
        }

        .toast-info .toast-icon {
            background: var(--primary);
            color: white;
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                transition: var(--transition);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .mobile-menu-btn {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .table-actions {
                flex-direction: column;
            }
        }

        /* ==================== LOGIN PAGE ==================== */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            padding: 20px;
        }

        .login-card {
            background: var(--light-card);
            border-radius: var(--radius);
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo .brand-logo {
            margin: 0 auto 15px;
        }

        .login-title {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-title h2 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .login-title p {
            color: var(--text-light);
        }
    </style>
</head>
<body class="dark-mode">
    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <div class="toast-icon">
            <i class="fas fa-info-circle"></i>
        </div>
        <div class="toast-content"></div>
        <button class="btn btn-icon btn-outline" onclick="hideToast()">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="login-container">
        <div class="login-card">
            <div class="login-logo">
                <div class="brand-logo">
                    <i class="fas fa-tools"></i>
                </div>
                <div class="brand-text">Malik Service</div>
            </div>
            
            <div class="login-title">
                <h2>Admin Dashboard</h2>
                <p>Sign in to continue</p>
            </div>
            
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" class="form-control" placeholder="Enter username" required value="admin">
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Enter password" required value="123456">
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>
                </div>
                
                <div class="text-center mt-3">
                    <small style="color: var(--text-light);">
                        Default credentials: admin / 123456
                    </small>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="app-container" class="app-container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="brand">
                <div class="brand-logo">
                    <i class="fas fa-tools"></i>
                </div>
                <div class="brand-text">Malik Service</div>
            </div>
            
            <div class="nav-menu">
                <a href="#dashboard" class="nav-item active" onclick="showSection('dashboard')">
                    <i class="fas fa-chart-line"></i>
                    <span class="nav-label">Dashboard</span>
                </a>
                
                <a href="#services" class="nav-item" onclick="showSection('services')">
                    <i class="fas fa-wrench"></i>
                    <span class="nav-label">Layanan</span>
                </a>
                
                <a href="#orders" class="nav-item" onclick="showSection('orders')">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="nav-label">Pesanan</span>
                    <span class="nav-badge" id="pending-orders">0</span>
                </a>
                
                <a href="#manual-order" class="nav-item" onclick="showSection('manual-order')">
                    <i class="fas fa-edit"></i>
                    <span class="nav-label">Buat Order Manual</span>
                </a>
                
                <a href="#discounts" class="nav-item" onclick="showSection('discounts')">
                    <i class="fas fa-tag"></i>
                    <span class="nav-label">Diskon</span>
                </a>
                
                <a href="#reports" class="nav-item" onclick="showSection('reports')">
                    <i class="fas fa-chart-bar"></i>
                    <span class="nav-label">Laporan</span>
                </a>
                
                <a href="#settings" class="nav-item" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i>
                    <span class="nav-label">Pengaturan</span>
                </a>
            </div>
            
            <div class="user-profile">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-info">
                    <h4 id="user-name">Administrator</h4>
                    <p id="user-role">Super Admin</p>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <h1 id="page-title">Dashboard</h1>
                </div>
                
                <div class="header-right">
                    <button class="header-btn" onclick="toggleTheme()" title="Toggle Theme">
                        <i class="fas fa-moon"></i>
                    </button>
                    
                    <div style="position: relative;">
                        <button class="header-btn" onclick="showNotifications()" title="Notifications">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">3</span>
                        </button>
                    </div>
                    
                    <button class="header-btn" onclick="logout()" title="Logout">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>

            <!-- Dashboard Section -->
            <section id="dashboard-section" class="section active">
                <!-- Stats Cards -->
                <div class="stats-grid" id="stats-cards">
                    <!-- Loaded by JavaScript -->
                </div>

                <!-- Recent Orders -->
                <div class="table-container">
                    <div class="table-header">
                        <h3>Pesanan Terbaru</h3>
                        <div class="table-actions">
                            <button class="btn btn-outline btn-sm" onclick="refreshOrders()">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table id="recent-orders-table">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Pelanggan</th>
                                    <th>Layanan</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Tanggal</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Loaded by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Services Section -->
            <section id="services-section" class="section">
                <div class="table-container">
                    <div class="table-header">
                        <h3>Daftar Layanan</h3>
                        <div class="table-actions">
                            <button class="btn btn-primary btn-sm" onclick="showServiceForm()">
                                <i class="fas fa-plus"></i> Tambah Layanan
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="refreshServices()">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table id="services-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Kategori</th>
                                    <th>Tipe Masalah</th>
                                    <th>Nama Layanan</th>
                                    <th>Jenis Biaya</th>
                                    <th>Harga Jual</th>
                                    <th>Estimasi Waktu</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Loaded by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Orders Section -->
            <section id="orders-section" class="section">
                <div class="table-container">
                    <div class="table-header">
                        <h3>Semua Pesanan</h3>
                        <div class="table-actions">
                            <select id="order-filter" class="form-control" style="width: 150px;" onchange="filterOrders()">
                                <option value="">Semua Status</option>
                                <option value="Pending">Pending</option>
                                <option value="Dikonfirmasi">Dikonfirmasi</option>
                                <option value="Diproses">Diproses</option>
                                <option value="Selesai">Selesai</option>
                                <option value="Dibatalkan">Dibatalkan</option>
                                <option value="Menunggu_Part">Menunggu Part</option>
                            </select>
                            <button class="btn btn-outline btn-sm" onclick="refreshOrders()">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table id="orders-table">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Pelanggan</th>
                                    <th>WhatsApp</th>
                                    <th>Kategori</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Pembayaran</th>
                                    <th>Tanggal</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Loaded by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Manual Order Section -->
            <section id="manual-order-section" class="section">
                <div class="table-container">
                    <div class="table-header">
                        <h3>Buat Order Manual</h3>
                    </div>
                    <div class="form-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nama Pelanggan *</label>
                                <input type="text" id="manual-customer-name" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label>Nomor WhatsApp *</label>
                                <input type="tel" id="manual-customer-phone" class="form-control" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Alamat</label>
                            <textarea id="manual-customer-address" class="form-control" rows="2"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Layanan (Format: Nama Layanan - Harga)</label>
                            <textarea id="manual-services" class="form-control" rows="5" 
                                      placeholder="Contoh:
1. Service Laptop - Rp 150.000
2. Ganti LCD HP - Rp 350.000
3. Install Windows - Rp 100.000"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Kategori</label>
                                <select id="manual-category" class="form-control">
                                    <option value="Manual">Manual</option>
                                    <option value="ANDROID">Android</option>
                                    <option value="LAPTOP">Laptop</option>
                                    <option value="PC">PC</option>
                                    <option value="PRINTER">Printer</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Diskon (Rp)</label>
                                <input type="number" id="manual-discount" class="form-control" value="0" min="0">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Biaya Tambahan (Rp)</label>
                                <input type="number" id="manual-additional-fees" class="form-control" value="0" min="0">
                            </div>
                            <div class="form-group">
                                <label>Status Awal</label>
                                <select id="manual-status" class="form-control">
                                    <option value="Pending">Pending</option>
                                    <option value="Dikonfirmasi">Dikonfirmasi</option>
                                    <option value="Diproses">Diproses</option>
                                    <option value="Selesai">Selesai</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Metode Bayar</label>
                                <select id="manual-payment-method" class="form-control">
                                    <option value="">Pilih Metode</option>
                                    <option value="Cash">Cash</option>
                                    <option value="Transfer">Transfer</option>
                                    <option value="QRIS">QRIS</option>
                                    <option value="Debit/Credit">Debit/Credit</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Status Bayar</label>
                                <select id="manual-payment-status" class="form-control">
                                    <option value="Belum_Bayar">Belum Bayar</option>
                                    <option value="DP_50%">DP 50%</option>
                                    <option value="Lunas">Lunas</option>
                                    <option value="Gratis">Gratis</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Catatan Admin</label>
                            <textarea id="manual-admin-notes" class="form-control" rows="3"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Catatan Pelanggan</label>
                            <textarea id="manual-customer-notes" class="form-control" rows="2"></textarea>
                        </div>
                        
                        <div class="form-footer">
                            <button type="button" class="btn btn-outline" onclick="calculateManualTotal()">
                                <i class="fas fa-calculator"></i> Hitung Total
                            </button>
                            <button type="button" class="btn btn-primary" onclick="submitManualOrder()">
                                <i class="fas fa-save"></i> Simpan Order
                            </button>
                        </div>
                        
                        <div id="manual-total-display" class="mt-3" style="display: none;">
                            <h4>Rincian Order:</h4>
                            <div id="manual-summary"></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Discounts Section -->
            <section id="discounts-section" class="section">
                <div class="table-container">
                    <div class="table-header">
                        <h3>Manajemen Diskon</h3>
                        <div class="table-actions">
                            <button class="btn btn-primary btn-sm" onclick="showDiscountForm()">
                                <i class="fas fa-plus"></i> Tambah Diskon
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="refreshDiscounts()">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table id="discounts-table">
                            <thead>
                                <tr>
                                    <th>Kode</th>
                                    <th>Tipe</th>
                                    <th>Nilai</th>
                                    <th>Min Order</th>
                                    <th>Maks Diskon</th>
                                    <th>Berlaku Mulai</th>
                                    <th>Berlaku Hingga</th>
                                    <th>Status</th>
                                    <th>Digunakan</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Loaded by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- Reports Section -->
            <section id="reports-section" class="section">
                <div class="table-container">
                    <div class="table-header">
                        <h3>Laporan & Analitik</h3>
                        <div class="table-actions">
                            <select id="report-period" class="form-control" style="width: 150px;" onchange="loadReports()">
                                <option value="today">Hari Ini</option>
                                <option value="week">Minggu Ini</option>
                                <option value="month">Bulan Ini</option>
                                <option value="year">Tahun Ini</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-body">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon" style="background: #3b82f620; color: #3b82f6;">
                                    <i class="fas fa-shopping-cart"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value" id="report-orders">0</div>
                                    <div class="stat-label">Total Pesanan</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="background: #10b98120; color: #10b981;">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value" id="report-revenue">Rp 0</div>
                                    <div class="stat-label">Total Pendapatan</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="background: #f59e0b20; color: #f59e0b;">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value" id="report-avg">Rp 0</div>
                                    <div class="stat-label">Rata-rata Order</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="background: #8b5cf620; color: #8b5cf6;">
                                    <i class="fas fa-wrench"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value" id="report-services">0</div>
                                    <div class="stat-label">Layanan Terjual</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h4>Top Layanan</h4>
                            <table class="table" id="top-services-table">
                                <thead>
                                    <tr>
                                        <th>Layanan</th>
                                        <th>Jumlah Terjual</th>
                                        <th>Total Pendapatan</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Loaded by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Settings Section -->
            <section id="settings-section" class="section">
                <div class="table-container">
                    <div class="table-header">
                        <h3>Pengaturan Sistem</h3>
                    </div>
                    <div class="form-body">
                        <div class="form-group">
                            <label>Nama Perusahaan</label>
                            <input type="text" id="company-name" class="form-control" value="Malik Service Center">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Telepon</label>
                                <input type="text" id="company-phone" class="form-control" value="081234567890">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="company-email" class="form-control" value="info@malikservice.com">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Alamat</label>
                            <textarea id="company-address" class="form-control" rows="2">Jl. Contoh No. 123, Jakarta</textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Prefix Receipt</label>
                                <input type="text" id="receipt-prefix" class="form-control" value="MSC">
                            </div>
                            <div class="form-group">
                                <label>Auto Backup</label>
                                <select id="auto-backup" class="form-control">
                                    <option value="true">Aktif</option>
                                    <option value="false">Nonaktif</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-footer">
                            <button type="button" class="btn btn-primary" onclick="saveSettings()">
                                <i class="fas fa-save"></i> Simpan Pengaturan
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Service Form Modal -->
    <div id="service-form-modal" class="form-modal">
        <div class="form-container">
            <div class="form-header">
                <h3 id="service-form-title">Tambah Layanan Baru</h3>
                <button class="btn btn-icon btn-outline" onclick="hideServiceForm()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="form-body">
                <form id="service-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Kategori *</label>
                            <select id="service-category" class="form-control" required>
                                <option value="">Pilih Kategori</option>
                                <option value="ANDROID">Android</option>
                                <option value="LAPTOP">Laptop</option>
                                <option value="PC">PC</option>
                                <option value="PRINTER">Printer</option>
                                <option value="TV">TV</option>
                                <option value="MONITOR">Monitor</option>
                                <option value="CCTV">CCTV</option>
                                <option value="CONSOLE">Console</option>
                                <option value="KULKAS">Kulkas</option>
                                <option value="AC">AC</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Tipe Masalah *</label>
                            <select id="service-type" class="form-control" required>
                                <option value="">Pilih Tipe</option>
                                <option value="Ringan">Ringan</option>
                                <option value="Sedang">Sedang</option>
                                <option value="Berat">Berat</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Nama Layanan *</label>
                        <input type="text" id="service-name" class="form-control" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Jenis Biaya</label>
                            <select id="service-cost-type" class="form-control">
                                <option value="Sparepart + Jasa">Sparepart + Jasa</option>
                                <option value="Jasa">Jasa</option>
                                <option value="Sparepart">Sparepart</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Estimasi Waktu</label>
                            <input type="text" id="service-estimate" class="form-control" value="1-2 Jam">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Harga Dasar (Rp)</label>
                            <input type="number" id="service-base-price" class="form-control" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Harga Jual (Rp) *</label>
                            <input type="number" id="service-sell-price" class="form-control" min="0" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Deskripsi</label>
                        <textarea id="service-description" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Status</label>
                        <select id="service-status" class="form-control">
                            <option value="active">Aktif</option>
                            <option value="inactive">Nonaktif</option>
                        </select>
                    </div>
                    
                    <input type="hidden" id="service-id">
                </form>
            </div>
            
            <div class="form-footer">
                <button type="button" class="btn btn-outline" onclick="hideServiceForm()">Batal</button>
                <button type="button" class="btn btn-primary" onclick="saveService()">Simpan</button>
            </div>
        </div>
    </div>
    
    <!-- Discount Form Modal -->
    <div id="discount-form-modal" class="form-modal">
        <div class="form-container">
            <div class="form-header">
                <h3 id="discount-form-title">Tambah Diskon Baru</h3>
                <button class="btn btn-icon btn-outline" onclick="hideDiscountForm()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="form-body">
                <form id="discount-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Kode Diskon *</label>
                            <input type="text" id="discount-code" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Tipe Diskon *</label>
                            <select id="discount-type" class="form-control" required>
                                <option value="persen">Persentase</option>
                                <option value="nominal">Nominal</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nilai Diskon *</label>
                            <input type="number" id="discount-value" class="form-control" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Minimal Order (Rp)</label>
                            <input type="number" id="discount-min-order" class="form-control" min="0">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Maksimal Diskon (Rp)</label>
                            <input type="number" id="discount-max-discount" class="form-control" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label>Status</label>
                            <select id="discount-status" class="form-control">
                                <option value="active">Aktif</option>
                                <option value="inactive">Nonaktif</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Berlaku Mulai *</label>
                            <input type="date" id="discount-start-date" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Berlaku Hingga *</label>
                            <input type="date" id="discount-end-date" class="form-control" required>
                        </div>
                    </div>
                    
                    <input type="hidden" id="discount-id">
                </form>
            </div>
            
            <div class="form-footer">
                <button type="button" class="btn btn-outline" onclick="hideDiscountForm()">Batal</button>
                <button type="button" class="btn btn-primary" onclick="saveDiscount()">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Order Detail Modal -->
    <div id="order-detail-modal" class="form-modal">
        <div class="form-container">
            <div class="form-header">
                <h3>Detail Order</h3>
                <button class="btn btn-icon btn-outline" onclick="hideOrderDetail()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="form-body" id="order-detail-content">
                <!-- Loaded by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Payment Update Modal -->
    <div id="payment-modal" class="form-modal">
        <div class="form-container">
            <div class="form-header">
                <h3>Update Pembayaran</h3>
                <button class="btn btn-icon btn-outline" onclick="hidePaymentModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="form-body">
                <div class="form-group">
                    <label>Metode Bayar</label>
                    <select id="payment-method" class="form-control">
                        <option value="">Pilih Metode</option>
                        <option value="Cash">Cash</option>
                        <option value="Transfer">Transfer</option>
                        <option value="QRIS">QRIS</option>
                        <option value="Debit/Credit">Debit/Credit</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Status Bayar</label>
                    <select id="payment-status" class="form-control">
                        <option value="Belum_Bayar">Belum Bayar</option>
                        <option value="DP_50%">DP 50%</option>
                        <option value="Lunas">Lunas</option>
                        <option value="Gratis">Gratis</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Catatan</label>
                    <textarea id="payment-notes" class="form-control" rows="3" placeholder="Catatan pembayaran..."></textarea>
                </div>
                
                <input type="hidden" id="payment-order-id">
            </div>
            
            <div class="form-footer">
                <button type="button" class="btn btn-outline" onclick="hidePaymentModal()">Batal</button>
                <button type="button" class="btn btn-primary" onclick="updatePayment()">Simpan</button>
            </div>
        </div>
    </div>
    
    <!-- Status Update Modal -->
    <div id="status-modal" class="form-modal">
        <div class="form-container">
            <div class="form-header">
                <h3>Update Status Order</h3>
                <button class="btn btn-icon btn-outline" onclick="hideStatusModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="form-body">
                <div class="form-group">
                    <label>Status Order</label>
                    <select id="status-select" class="form-control">
                        <option value="Pending">Pending</option>
                        <option value="Dikonfirmasi">Dikonfirmasi</option>
                        <option value="Diproses">Diproses</option>
                        <option value="Selesai">Selesai</option>
                        <option value="Dibatalkan">Dibatalkan</option>
                        <option value="Menunggu_Part">Menunggu Part</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Catatan</label>
                    <textarea id="status-notes" class="form-control" rows="3" placeholder="Catatan perubahan status..."></textarea>
                </div>
                
                <input type="hidden" id="status-order-id">
            </div>
            
            <div class="form-footer">
                <button type="button" class="btn btn-outline" onclick="hideStatusModal()">Batal</button>
                <button type="button" class="btn btn-primary" onclick="updateOrderStatus()">Simpan</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== CONFIGURATION ====================
        // SIMULASI BACKEND - TIDAK PERLU URL EKSTERNAL
        const CONFIG = {
            APP_VERSION: "4.0.0",
            TOKEN_KEY: "malik_admin_token",
            USER_KEY: "malik_admin_user",
            DATA_KEY: "malik_service_data"
        };

        // ==================== SIMULATED DATABASE ====================
        let simulatedDatabase = {
            services: [
                {
                    id: 1,
                    kategori: "ANDROID",
                    tipe: "Ringan",
                    nama: "Ganti Kaca Pelindung",
                    jenis_biaya: "Sparepart + Jasa",
                    harga_dasar: 50000,
                    harga_jual: 150000,
                    estimasi: "1-2 Jam",
                    deskripsi: "Hanya kaca luar, LCD masih bagus",
                    status: "active"
                },
                {
                    id: 2,
                    kategori: "LAPTOP",
                    tipe: "Ringan",
                    nama: "Cleaning + Thermal Paste",
                    jenis_biaya: "Jasa",
                    harga_dasar: 80000,
                    harga_jual: 125000,
                    estimasi: "1-2 Jam",
                    deskripsi: "Include pasta premium",
                    status: "active"
                },
                {
                    id: 3,
                    kategori: "PC",
                    tipe: "Ringan",
                    nama: "Rakit PC Baru",
                    jenis_biaya: "Jasa",
                    harga_dasar: 150000,
                    harga_jual: 250000,
                    estimasi: "3-4 Jam",
                    deskripsi: "Instalasi semua komponen",
                    status: "active"
                }
            ],
            orders: [
                {
                    Order_ID: "ORD20241215001",
                    Nama_Pelanggan: "Budi Santoso",
                    WhatsApp: "081234567890",
                    Kategori: "ANDROID",
                    Total_Bayar: 150000,
                    Status: "Selesai",
                    Status_Bayar: "Lunas",
                    Timestamp: new Date().toISOString(),
                    details: {
                        items: [
                            { nama: "Ganti Kaca Pelindung", harga: 150000 }
                        ],
                        calculation: {
                            subtotal: 150000,
                            discount: 0,
                            additional_fees: 0,
                            total: 150000
                        }
                    }
                },
                {
                    Order_ID: "ORD20241215002",
                    Nama_Pelanggan: "Siti Rahayu",
                    WhatsApp: "081298765432",
                    Kategori: "LAPTOP",
                    Total_Bayar: 125000,
                    Status: "Diproses",
                    Status_Bayar: "DP_50%",
                    Timestamp: new Date(Date.now() - 86400000).toISOString(),
                    details: {
                        items: [
                            { nama: "Cleaning + Thermal Paste", harga: 125000 }
                        ],
                        calculation: {
                            subtotal: 125000,
                            discount: 0,
                            additional_fees: 0,
                            total: 125000
                        }
                    }
                }
            ],
            discounts: [
                {
                    Kode: "WELCOME10",
                    Tipe: "persen",
                    Nilai: 10,
                    Min_Order: 100000,
                    Maks_Diskon: 50000,
                    Berlaku_Mulai: new Date().toISOString(),
                    Berlaku_Hingga: new Date(Date.now() + 30 * 86400000).toISOString(),
                    Status: "active",
                    Digunakan: 5
                }
            ],
            settings: {
                company_name: "Malik Service Center",
                company_phone: "081234567890",
                company_email: "info@malikservice.com",
                company_address: "Jl. Contoh No. 123, Jakarta",
                receipt_prefix: "MSC",
                auto_backup: true
            }
        };

        // ==================== STATE MANAGEMENT ====================
        let state = {
            token: localStorage.getItem(CONFIG.TOKEN_KEY) || null,
            user: JSON.parse(localStorage.getItem(CONFIG.USER_KEY)) || null,
            currentSection: 'dashboard',
            services: [],
            orders: [],
            discounts: [],
            stats: null
        };

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log(' Malik Service Admin v' + CONFIG.APP_VERSION);
            console.log('Mode: Simulated Database');
            
            // Load simulated data from localStorage or use default
            const savedData = localStorage.getItem(CONFIG.DATA_KEY);
            if (savedData) {
                simulatedDatabase = JSON.parse(savedData);
            }
            
            // Check authentication
            if (state.token && state.user) {
                showMainApp();
                loadDashboard();
            } else {
                showLoginPage();
            }
            
            // Setup event listeners
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            setupTheme();
        });

        // ==================== SIMULATED API FUNCTIONS ====================
        async function simulatedAPI(action, data = {}) {
            console.log('Simulated API:', action, data);
            
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 500));
            
            switch(action) {
                case 'login_admin':
                    if (data.username === 'admin' && data.password === '123456') {
                        return {
                            success: true,
                            token: 'simulated_token_' + Date.now(),
                            user: {
                                username: 'admin',
                                role: 'superadmin',
                                name: 'Administrator Utama',
                                phone: '081234567890',
                                permissions: 'all'
                            }
                        };
                    } else {
                        return { success: false, message: 'Invalid credentials' };
                    }
                    
                case 'get_stats':
                    const totalOrders = simulatedDatabase.orders.length;
                    const completedOrders = simulatedDatabase.orders.filter(o => o.Status === 'Selesai').length;
                    const totalRevenue = simulatedDatabase.orders
                        .filter(o => o.Status === 'Selesai')
                        .reduce((sum, o) => sum + (o.Total_Bayar || 0), 0);
                    const pendingOrders = simulatedDatabase.orders.filter(o => o.Status === 'Pending').length;
                    
                    return {
                        success: true,
                        stats: {
                            total_orders: totalOrders,
                            total_revenue: totalRevenue,
                            pending_orders: pendingOrders,
                            total_services: simulatedDatabase.services.length,
                            completed_orders: completedOrders
                        }
                    };
                    
                case 'get_all_orders':
                    let filteredOrders = [...simulatedDatabase.orders];
                    
                    if (data.filter && data.filter.status) {
                        filteredOrders = filteredOrders.filter(o => o.Status === data.filter.status);
                    }
                    
                    // Sort by date (newest first)
                    filteredOrders.sort((a, b) => new Date(b.Timestamp) - new Date(a.Timestamp));
                    
                    return {
                        success: true,
                        data: filteredOrders,
                        count: filteredOrders.length,
                        summary: {
                            total: filteredOrders.length,
                            pending: filteredOrders.filter(o => o.Status === 'Pending').length,
                            in_progress: filteredOrders.filter(o => o.Status === 'Diproses').length,
                            completed: filteredOrders.filter(o => o.Status === 'Selesai').length,
                            revenue: filteredOrders
                                .filter(o => o.Status === 'Selesai')
                                .reduce((sum, o) => sum + (o.Total_Bayar || 0), 0)
                        }
                    };
                    
                case 'track_order':
                    const order = simulatedDatabase.orders.find(o => o.Order_ID === data.orderId);
                    if (order) {
                        return {
                            success: true,
                            order: order
                        };
                    }
                    return { success: false, message: 'Order not found' };
                    
                case 'get_all_services':
                    return {
                        success: true,
                        data: simulatedDatabase.services,
                        count: simulatedDatabase.services.length
                    };
                    
                case 'add_service':
                    const newService = {
                        id: simulatedDatabase.services.length + 1,
                        ...data.service,
                        status: data.service.status || 'active'
                    };
                    simulatedDatabase.services.push(newService);
                    saveToLocalStorage();
                    return {
                        success: true,
                        message: 'Service added successfully',
                        id: newService.id
                    };
                    
                case 'update_service':
                    const serviceIndex = simulatedDatabase.services.findIndex(s => s.id === data.id);
                    if (serviceIndex !== -1) {
                        simulatedDatabase.services[serviceIndex] = {
                            ...simulatedDatabase.services[serviceIndex],
                            ...data.updates
                        };
                        saveToLocalStorage();
                        return { success: true, message: 'Service updated successfully' };
                    }
                    return { success: false, message: 'Service not found' };
                    
                case 'delete_service':
                    const deleteIndex = simulatedDatabase.services.findIndex(s => s.id === data.id);
                    if (deleteIndex !== -1) {
                        simulatedDatabase.services[deleteIndex].status = 'inactive';
                        saveToLocalStorage();
                        return { success: true, message: 'Service marked as inactive' };
                    }
                    return { success: false, message: 'Service not found' };
                    
                case 'create_manual_order':
                    const orderId = 'ORD' + new Date().getFullYear() + 
                                   (new Date().getMonth() + 1).toString().padStart(2, '0') + 
                                   new Date().getDate().toString().padStart(2, '0') +
                                   (simulatedDatabase.orders.length + 1).toString().padStart(3, '0');
                    
                    const subtotal = data.orderData.services.reduce((sum, s) => sum + (s.harga || 0), 0);
                    const discount = data.orderData.discount || 0;
                    const additionalFees = data.orderData.additional_fees || 0;
                    const total = Math.max(0, subtotal - discount + additionalFees);
                    
                    const newOrder = {
                        Order_ID: orderId,
                        Nama_Pelanggan: data.orderData.customer_name,
                        WhatsApp: data.orderData.customer_phone,
                        Alamat: data.orderData.customer_address,
                        Kategori: data.orderData.category || 'Manual',
                        Total_Bayar: total,
                        Status: data.orderData.status || 'Pending',
                        Status_Bayar: data.orderData.payment_status || 'Belum_Bayar',
                        Metode_Bayar: data.orderData.payment_method || '',
                        Catatan_Admin: data.orderData.admin_notes || '',
                        Catatan_Pelanggan: data.orderData.customer_notes || '',
                        Timestamp: new Date().toISOString(),
                        details: {
                            items: data.orderData.services,
                            calculation: {
                                subtotal: subtotal,
                                discount: discount,
                                additional_fees: additionalFees,
                                total: total
                            }
                        }
                    };
                    
                    simulatedDatabase.orders.push(newOrder);
                    saveToLocalStorage();
                    
                    return {
                        success: true,
                        order_id: orderId,
                        receipt_number: 'MSC' + orderId.substring(3),
                        calculation: {
                            subtotal: subtotal,
                            discount: discount,
                            additional_fees: additionalFees,
                            total: total
                        }
                    };
                    
                case 'update_order_status':
                    const orderToUpdate = simulatedDatabase.orders.find(o => o.Order_ID === data.orderId);
                    if (orderToUpdate) {
                        orderToUpdate.Status = data.status;
                        orderToUpdate.Catatan_Admin = (orderToUpdate.Catatan_Admin || '') + 
                            `\n[${new Date().toLocaleString()}] Status changed to ${data.status}`;
                        if (data.notes) {
                            orderToUpdate.Catatan_Admin += ` - ${data.notes}`;
                        }
                        saveToLocalStorage();
                        return { success: true, message: 'Order status updated' };
                    }
                    return { success: false, message: 'Order not found' };
                    
                case 'update_payment':
                    const paymentOrder = simulatedDatabase.orders.find(o => o.Order_ID === data.orderId);
                    if (paymentOrder) {
                        paymentOrder.Status_Bayar = data.paymentData.status;
                        paymentOrder.Metode_Bayar = data.paymentData.method || paymentOrder.Metode_Bayar;
                        paymentOrder.Catatan_Admin = (paymentOrder.Catatan_Admin || '') + 
                            `\n[${new Date().toLocaleString()}] Payment updated: ${data.paymentData.status}`;
                        if (data.paymentData.notes) {
                            paymentOrder.Catatan_Admin += ` - ${data.paymentData.notes}`;
                        }
                        saveToLocalStorage();
                        return { success: true, message: 'Payment status updated' };
                    }
                    return { success: false, message: 'Order not found' };
                    
                case 'get_discounts':
                    return {
                        success: true,
                        data: simulatedDatabase.discounts,
                        count: simulatedDatabase.discounts.length
                    };
                    
                case 'add_discount':
                    const newDiscount = {
                        Kode: data.discount.code,
                        Tipe: data.discount.type,
                        Nilai: data.discount.value,
                        Min_Order: data.discount.min_order || 0,
                        Maks_Diskon: data.discount.max_discount || 0,
                        Berlaku_Mulai: new Date(data.discount.start_date).toISOString(),
                        Berlaku_Hingga: new Date(data.discount.end_date).toISOString(),
                        Status: data.discount.status || 'active',
                        Digunakan: 0
                    };
                    simulatedDatabase.discounts.push(newDiscount);
                    saveToLocalStorage();
                    return { success: true, message: 'Discount added successfully' };
                    
                case 'update_discount':
                    const discountIndex = simulatedDatabase.discounts.findIndex(d => d.Kode === data.code);
                    if (discountIndex !== -1) {
                        simulatedDatabase.discounts[discountIndex] = {
                            ...simulatedDatabase.discounts[discountIndex],
                            ...data.updates
                        };
                        saveToLocalStorage();
                        return { success: true, message: 'Discount updated successfully' };
                    }
                    return { success: false, message: 'Discount not found' };
                    
                case 'get_reports':
                    const today = new Date().toISOString().split('T')[0];
                    const todayOrders = simulatedDatabase.orders.filter(o => 
                        o.Timestamp.split('T')[0] === today
                    );
                    
                    return {
                        success: true,
                        data: {
                            total_orders: todayOrders.length,
                            total_revenue: todayOrders.reduce((sum, o) => sum + (o.Total_Bayar || 0), 0),
                            average_order: todayOrders.length > 0 ? 
                                Math.round(todayOrders.reduce((sum, o) => sum + (o.Total_Bayar || 0), 0) / todayOrders.length) : 0,
                            services_sold: todayOrders.reduce((sum, o) => sum + (o.details?.items?.length || 0), 0),
                            top_services: []
                        }
                    };
                    
                case 'print_receipt':
                    const receiptOrder = simulatedDatabase.orders.find(o => o.Order_ID === data.orderId);
                    if (receiptOrder) {
                        const receiptHTML = generateReceiptHTML(receiptOrder);
                        return {
                            success: true,
                            html_receipt: receiptHTML
                        };
                    }
                    return { success: false, message: 'Order not found' };
                    
                default:
                    return { success: false, message: 'Unknown action' };
            }
        }

        function saveToLocalStorage() {
            localStorage.setItem(CONFIG.DATA_KEY, JSON.stringify(simulatedDatabase));
        }

        function generateReceiptHTML(order) {
            const itemsHTML = (order.details?.items || []).map((item, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${item.nama || item.name}</td>
                    <td style="text-align: right;">Rp ${formatNumber(item.harga || item.price || 0)}</td>
                </tr>
            `).join('');
            
            const calculation = order.details?.calculation || {};
            const subtotal = calculation.subtotal || 0;
            const discount = calculation.discount || 0;
            const additionalFees = calculation.additional_fees || 0;
            const total = calculation.total || order.Total_Bayar || 0;
            
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Receipt ${order.Order_ID}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
                        .receipt { max-width: 400px; margin: 0 auto; }
                        .header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 10px; }
                        .header h2 { margin: 0; color: #1e3a8a; }
                        .order-info { margin-bottom: 20px; }
                        .order-info table { width: 100%; }
                        .order-info td { padding: 3px 0; }
                        .order-info td:first-child { font-weight: bold; width: 120px; }
                        .items { margin-bottom: 20px; }
                        .items table { width: 100%; border-collapse: collapse; }
                        .items th, .items td { border: 1px solid #ddd; padding: 8px; }
                        .items th { background-color: #f2f2f2; text-align: left; }
                        .items td { text-align: left; }
                        .items td:last-child { text-align: right; }
                        .footer { text-align: center; margin-top: 30px; font-size: 0.9em; color: #666; }
                    </style>
                </head>
                <body>
                    <div class="receipt">
                        <div class="header">
                            <h2>MALIK SERVICE CENTER</h2>
                            <p>Jl. Contoh No. 123, Jakarta</p>
                            <p>Telp: 0812-3456-7890</p>
                        </div>
                        
                        <div class="order-info">
                            <table>
                                <tr><td>Receipt No:</td><td>MSC${order.Order_ID.substring(3)}</td></tr>
                                <tr><td>Order ID:</td><td>${order.Order_ID}</td></tr>
                                <tr><td>Tanggal:</td><td>${new Date(order.Timestamp).toLocaleDateString('id-ID')}</td></tr>
                                <tr><td>Waktu:</td><td>${new Date(order.Timestamp).toLocaleTimeString('id-ID')}</td></tr>
                                <tr><td>Pelanggan:</td><td>${order.Nama_Pelanggan}</td></tr>
                                <tr><td>Status:</td><td>${order.Status}</td></tr>
                            </table>
                        </div>
                        
                        <div class="items">
                            <table>
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Layanan</th>
                                        <th>Harga</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${itemsHTML}
                                    <tr>
                                        <td colspan="2" style="text-align: right; font-weight: bold;">Subtotal:</td>
                                        <td style="text-align: right; font-weight: bold;">Rp ${formatNumber(subtotal)}</td>
                                    </tr>
                                    ${discount > 0 ? `
                                    <tr>
                                        <td colspan="2" style="text-align: right;">Diskon:</td>
                                        <td style="text-align: right;">- Rp ${formatNumber(discount)}</td>
                                    </tr>
                                    ` : ''}
                                    ${additionalFees > 0 ? `
                                    <tr>
                                        <td colspan="2" style="text-align: right;">Biaya Tambahan:</td>
                                        <td style="text-align: right;">+ Rp ${formatNumber(additionalFees)}</td>
                                    </tr>
                                    ` : ''}
                                    <tr style="border-top: 2px solid #333;">
                                        <td colspan="2" style="text-align: right; font-weight: bold; font-size: 1.1em;">TOTAL:</td>
                                        <td style="text-align: right; font-weight: bold; font-size: 1.1em;">Rp ${formatNumber(total)}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="footer">
                            <p>Terima kasih atas kepercayaan Anda</p>
                            <p>*** STRUK INI SAH ***</p>
                        </div>
                    </div>
                </body>
                </html>
            `;
        }

        // ==================== AUTHENTICATION ====================
        async function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                showToast('Username dan password harus diisi', 'error');
                return;
            }
            
            try {
                showLoader(true);
                
                // Use simulated API instead of fetch
                const result = await simulatedAPI('login_admin', { username, password });
                
                if (result.success) {
                    state.token = result.token;
                    state.user = result.user;
                    
                    localStorage.setItem(CONFIG.TOKEN_KEY, result.token);
                    localStorage.setItem(CONFIG.USER_KEY, JSON.stringify(result.user));
                    
                    showToast('Login berhasil!', 'success');
                    
                    setTimeout(() => {
                        showMainApp();
                        loadDashboard();
                    }, 1000);
                    
                } else {
                    showToast('Login gagal: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showToast('Error saat login: ' + error.message, 'error');
            } finally {
                showLoader(false);
            }
        }

        function logout() {
            if (confirm('Yakin ingin logout?')) {
                state.token = null;
                state.user = null;
                localStorage.removeItem(CONFIG.TOKEN_KEY);
                localStorage.removeItem(CONFIG.USER_KEY);
                showLoginPage();
                showToast('Logout berhasil', 'info');
            }
        }

        // ==================== UI FUNCTIONS ====================
        function showLoginPage() {
            document.getElementById('login-page').style.display = 'flex';
            document.getElementById('app-container').style.display = 'none';
        }

        function showMainApp() {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('app-container').style.display = 'flex';
            
            // Update user info
            if (state.user) {
                document.getElementById('user-name').textContent = state.user.name;
                document.getElementById('user-role').textContent = state.user.role;
            }
        }

        function showSection(sectionId) {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const navItem = document.querySelector(`[href="#${sectionId}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }
            
            // Update page title
            const titles = {
                'dashboard': 'Dashboard',
                'services': 'Manajemen Layanan',
                'orders': 'Manajemen Pesanan',
                'manual-order': 'Buat Order Manual',
                'discounts': 'Manajemen Diskon',
                'reports': 'Laporan & Analitik',
                'settings': 'Pengaturan Sistem'
            };
            
            document.getElementById('page-title').textContent = titles[sectionId] || 'Dashboard';
            
            // Show section
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            const section = document.getElementById(`${sectionId}-section`);
            if (section) {
                section.classList.add('active');
                state.currentSection = sectionId;
                
                // Load section data
                switch(sectionId) {
                    case 'dashboard':
                        loadDashboard();
                        break;
                    case 'services':
                        loadServices();
                        break;
                    case 'orders':
                        loadOrders();
                        break;
                    case 'discounts':
                        loadDiscounts();
                        break;
                    case 'reports':
                        loadReports();
                        break;
                    case 'settings':
                        loadSettings();
                        break;
                }
            }
        }

        // ==================== LOADER & TOAST ====================
        function showLoader(show) {
            document.getElementById('loader').classList.toggle('active', show);
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const content = toast.querySelector('.toast-content');
            
            content.textContent = message;
            toast.className = `toast toast-${type} show`;
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                toast.classList.remove('show');
            }, 5000);
        }

        function hideToast() {
            document.getElementById('toast').classList.remove('show');
        }

        // ==================== THEME ====================
        function setupTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
            }
        }

        function toggleTheme() {
            const isDark = document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            
            const icon = document.querySelector('[title="Toggle Theme"] i');
            icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
        }

        // ==================== DASHBOARD ====================
        async function loadDashboard() {
            try {
                showLoader(true);
                
                const [statsRes, ordersRes] = await Promise.all([
                    simulatedAPI('get_stats'),
                    simulatedAPI('get_all_orders')
                ]);
                
                if (statsRes.success) {
                    state.stats = statsRes.stats;
                    renderStatsCards();
                }
                
                if (ordersRes.success) {
                    state.orders = ordersRes.data || [];
                    renderRecentOrders();
                    
                    // Update pending orders badge
                    const pendingCount = ordersRes.data?.filter(o => o.Status === 'Pending').length || 0;
                    document.getElementById('pending-orders').textContent = pendingCount;
                }
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
                showToast('Gagal memuat dashboard: ' + error.message, 'error');
            } finally {
                showLoader(false);
            }
        }

        function renderStatsCards() {
            const stats = state.stats;
            if (!stats) return;
            
            const cards = [
                {
                    icon: 'fas fa-shopping-cart',
                    color: '#3b82f6',
                    value: stats.total_orders || 0,
                    label: 'Total Pesanan',
                    change: '+12%'
                },
                {
                    icon: 'fas fa-money-bill-wave',
                    color: '#10b981',
                    value: 'Rp ' + formatNumber(stats.total_revenue || 0),
                    label: 'Total Pendapatan',
                    change: '+8%'
                },
                {
                    icon: 'fas fa-clock',
                    color: '#f59e0b',
                    value: stats.pending_orders || 0,
                    label: 'Menunggu Diproses',
                    change: stats.pending_orders > 5 ? 'Perlu Tindakan' : null
                },
                {
                    icon: 'fas fa-wrench',
                    color: '#8b5cf6',
                    value: stats.total_services || 0,
                    label: 'Jumlah Layanan',
                    change: null
                }
            ];
            
            const container = document.getElementById('stats-cards');
            container.innerHTML = cards.map(card => `
                <div class="stat-card">
                    <div class="stat-icon" style="background: ${card.color}20; color: ${card.color};">
                        <i class="${card.icon}"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value">${card.value}</div>
                        <div class="stat-label">${card.label}</div>
                        ${card.change ? `
                            <div class="stat-change ${card.change.includes('+') ? 'positive' : card.change.includes('-') ? 'negative' : ''}">
                                ${card.change}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function renderRecentOrders() {
            const tbody = document.querySelector('#recent-orders-table tbody');
            
            if (!state.orders || state.orders.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">Tidak ada pesanan</td>
                    </tr>
                `;
                return;
            }
            
            const recentOrders = state.orders.slice(0, 10);
            
            tbody.innerHTML = recentOrders.map(order => {
                const details = order.details || {};
                const services = details.items || [];
                const serviceNames = services.map(s => s.nama || s.name || 'Layanan').join(', ').substring(0, 30);
                
                return `
                    <tr>
                        <td><strong>${order.Order_ID}</strong></td>
                        <td>${order.Nama_Pelanggan}</td>
                        <td>${serviceNames}${serviceNames.length > 30 ? '...' : ''}</td>
                        <td>Rp ${formatNumber(order.Total_Bayar || 0)}</td>
                        <td><span class="badge ${getStatusBadgeClass(order.Status)}">${order.Status}</span></td>
                        <td>${new Date(order.Timestamp).toLocaleDateString('id-ID')}</td>
                        <td>
                            <button class="btn btn-sm btn-outline" onclick="viewOrderDetail('${order.Order_ID}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline" onclick="showStatusModal('${order.Order_ID}')">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ==================== SERVICES MANAGEMENT ====================
        async function loadServices() {
            try {
                showLoader(true);
                
                const response = await simulatedAPI('get_all_services');
                
                if (response.success) {
                    state.services = response.data || [];
                    renderServicesTable();
                } else {
                    showToast('Gagal memuat layanan: ' + response.message, 'error');
                }
            } catch (error) {
                console.error('Error loading services:', error);
                showToast('Error memuat layanan: ' + error.message, 'error');
            } finally {
                showLoader(false);
            }
        }

        function renderServicesTable() {
            const tbody = document.querySelector('#services-table tbody');
            
            if (!state.services || state.services.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center">Tidak ada layanan</td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = state.services.map((service, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${service.kategori}</td>
                    <td>${service.tipe}</td>
                    <td><strong>${service.nama}</strong></td>
                    <td>${service.jenis_biaya}</td>
                    <td>Rp ${formatNumber(service.harga_jual || 0)}</td>
                    <td>${service.estimasi || '1-2 Jam'}</td>
                    <td>
                        <span class="badge ${service.status === 'active' ? 'badge-success' : 'badge-danger'}">
                            ${service.status === 'active' ? 'Aktif' : 'Nonaktif'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline" onclick="editService(${service.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline" onclick="deleteService(${service.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function showServiceForm(serviceId = null) {
            const modal = document.getElementById('service-form-modal');
            const title = document.getElementById('service-form-title');
            const form = document.getElementById('service-form');
            
            if (serviceId) {
                title.textContent = 'Edit Layanan';
                const service = state.services.find(s => s.id == serviceId);
                if (service) {
                    document.getElementById('service-id').value = service.id;
                    document.getElementById('service-category').value = service.kategori;
                    document.getElementById('service-type').value = service.tipe;
                    document.getElementById('service-name').value = service.nama;
                    document.getElementById('service-cost-type').value = service.jenis_biaya;
                    document.getElementById('service-estimate').value = service.estimasi || '1-2 Jam';
                    document.getElementById('service-base-price').value = service.harga_dasar || 0;
                    document.getElementById('service-sell-price').value = service.harga_jual || 0;
                    document.getElementById('service-description').value = service.deskripsi || '';
                    document.getElementById('service-status').value = service.status || 'active';
                }
            } else {
                title.textContent = 'Tambah Layanan Baru';
                form.reset();
                document.getElementById('service-id').value = '';
                document.getElementById('service-status').value = 'active';
                document.getElementById('service-estimate').value = '1-2 Jam';
                document.getElementById('service-cost-type').value = 'Sparepart + Jasa';
            }
            
            modal.classList.add('active');
        }

        function hideServiceForm() {
            document.getElementById('service-form-modal').classList.remove('active');
        }

        async function saveService() {
            const form = document.getElementById('service-form');
            const serviceId = document.getElementById('service-id').value;
            
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const serviceData = {
                kategori: document.getElementById('service-category').value,
                tipe: document.getElementById('service-type').value,
                nama: document.getElementById('service-name').value,
                jenis_biaya: document.getElementById('service-cost-type').value,
                estimasi: document.getElementById('service-estimate').value,
                harga_dasar: parseFloat(document.getElementById('service-base-price').value) || 0,
                harga_jual: parseFloat(document.getElementById('service-sell-price').value) || 0,
                deskripsi: document.getElementById('service-description').value,
                status: document.getElementById('service-status').value
            };
            
            try {
                showLoader(true);
                
                const action = serviceId ? 'update_service' : 'add_service';
                const params = serviceId ? 
                    { id: parseInt(serviceId), updates: serviceData } : 
                    { service: serviceData };
                
                const response = await simulatedAPI(action, params);
                
                if (response.success) {
                    showToast('Layanan berhasil disimpan', 'success');
                    hideServiceForm();
                    loadServices();
                } else {
                    showToast('Gagal menyimpan: ' + (response.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error saving service:', error);
                showToast('Error menyimpan layanan: ' + error.message, 'error');
            } finally {
                showLoader(false);
            }
        }

        async function deleteService(serviceId) {
            if (!confirm('Yakin ingin menghapus layanan ini?')) return;
            
            try {
                showLoader(true);
                
                const response = await simulatedAPI('delete_service', { id: parseInt(serviceId) });
                
                if (response.success) {
                    showToast('Layanan berhasil dihapus', 'success');
                    loadServices();
                } else {
                    showToast('Gagal menghapus: ' + response.message, 'error');
                }
            } catch (error) {
                console.error('Error deleting service:', error);
                showToast('Error menghapus layanan: ' + error.message, 'error');
            } finally {
                showLoader(false);
            }
        }

        function editService(serviceId) {
            showServiceForm(serviceId);
        }

        function refreshServices() {
            loadServices();
        }

        // ==================== ORDERS MANAGEMENT ====================
        async function loadOrders() {
            try {
                showLoader(true);
                
                const filter = document.getElementById('order-filter')?.value || '';
                const params = filter ? { filter: { status: filter } } : {};
                
                const response = await simulatedAPI('get_all_orders', params);
                
                if (response.success) {
                    state.orders = response.data || [];
                    renderOrdersTable();
                } else {
                    showToast('Gagal memuat pesanan: ' + response.message, 'error');
                }
            } catch (error) {
                console.error('Error loading orders:', error);
                showToast('Error memuat pesanan: ' + error.message, 'error');
            } finally {
                showLoader(false);
            }
        }

        function renderOrdersTable() {
            const tbody = document.querySelector('#orders-table tbody');
            
            if (!state.orders || state.orders.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center">Tidak ada pesanan</td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = state.orders.map(order => {
                return `
                    <tr>
                        <td><strong>${order.Order_ID}</strong></td>
                        <td>${order.Nama_Pelanggan}</td>
                        <td>${order.WhatsApp || '-'}</td>
                        <td>${order.Kategori || '-'}</td>
                        <td>Rp ${formatNumber(order.Total_Bayar || 0)}</td>
                        <td><span class="badge ${getStatusBadgeClass(order.Status)}">${order.Status}</span></td>
                        <td><span class="badge ${getPaymentBadgeClass(order.Status_Bayar)}">${order.Status_Bayar}</span></td>
                        <td>${new Date(order.Timestamp).toLocaleDateString('id-ID')}</td>
                        <td>
                            <button class="btn btn-sm btn-outline" onclick="viewOrderDetail('${order.Order_ID}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline" onclick="showStatusModal('${order.Order_ID}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline" onclick="showPaymentModal('${order.Order_ID}')">
                                <i class="fas fa-money-bill"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        async function viewOrderDetail(orderId) {
            try {
                showLoader(true);
                
                const response = await simulatedAPI('track_order', { orderId: orderId });
                
                if (response.success) {
                    const order = response.order;
                    const modal = document.getElementById('order-detail-modal');
                    const content = document.getElementById('order-detail-content');
                    
                    const details = order.details || {};
                    const services = details.items || [];
                    const servicesHTML = services.map((service, index) => `
                        <div style="padding: 10px; background: #f8fafc; border-radius: 8px; margin-bottom: 10px;">
                            <div style="font-weight: 600;">${index + 1}. ${service.nama || service.name}</div>
                            <div style="color: #64748b; font-size: 0.9em;">Rp ${formatNumber(service.harga || service.price || 0)}</div>
                        </div>
                    `).join('');
                    
                    const calculation = details.calculation || {};
                    
                    content.innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <h4>Informasi Order</h4>
                            <table style="width: 100%;">
                                <tr><td style="width: 120px; padding: 5px 0;">Order ID:</td><td><strong>${order.Order_ID}</strong></td></tr>
                                <tr><td style="padding: 5px 0;">Tanggal:</td><td>${new Date(order.Timestamp).toLocaleString('id-ID')}</td></tr>
                                <tr><td style="padding: 5px 0;">Status:</td><td><span class="badge ${getStatusBadgeClass(order.Status)}">${order.Status}</span></td></tr>
                                <tr><td style="padding: 5px 0;">Pembayaran:</td><td><span class="badge ${getPaymentBadgeClass(order.Status_Bayar)}">${order.Status_Bayar}</span></td></tr>
                                <tr><td style="padding: 5px 0;">Metode:</td><td>${order.Metode_Bayar || '-'}</td></tr>
                            </table>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4>Data Pelanggan</h4>
                            <table style="width: 100%;">
                                <tr><td style="width: 120px; padding: 5px 0;">Nama:</td><td>${order.Nama_Pelanggan}</td></tr>
                                <tr><td style="padding: 5px 0;">WhatsApp:</td><td>${order.WhatsApp || '-'}</td></tr>
                                <tr><td style="padding: 5px 0;">Alamat:</td><td>${order.Alamat || '-'}</td></tr>
                            </table>
                        </div>
                        
                        ${services.length > 0 ? `
                        <div style="margin-bottom: 20px;">
                            <h4>Layanan (${services.length})</h4>
                            ${servicesHTML}
                        </div>
                        ` : ''}
                        
                        <div style="border-top: 2px solid #e2e8f0; padding-top: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Subtotal:</span>
                                <span>Rp ${formatNumber(calculation.subtotal || 0)}</span>
                            </div>
                            ${(calculation.discount || 0) > 0 ? `
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Diskon:</span>
                                <span>- Rp ${formatNumber(calculation.discount || 0)}</span>
                            </div>
                            ` : ''}
                            ${(calculation.additional_fees || 0) > 0 ? `
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Biaya Tambahan:</span>
                                <span>+ Rp ${formatNumber(calculation.additional_fees || 0)}</span>
                            </div>
                            ` : ''}
                            <hr style="margin: 10px 0;">
                            <div style="display: flex; justify-content: space-between; font-size: 1.2em; font-weight: 600;">
                                <span>Total:</span>
                                <span>Rp ${formatNumber(calculation.total || order.Total_Bayar || 0)}</span>
                            </div>
                        </div>
                        
                        ${order.Catatan_Admin || order.Catatan_Pelanggan ? `
                        <div style="margin-top: 20px;">
                            ${order.Catatan_Admin ? `<p><strong>Catatan Admin:</strong> ${order.Catatan_Admin}</p>` : ''}
                            ${order.Catatan_Pelanggan ? `<p><strong>Catatan Pelanggan:</strong> ${order.Catatan_Pelanggan}</p>` : ''}
                        </div>
                        ` : ''}
                        
                        <div style="margin-top: 20px; display: flex; gap: 10px;">
                            <button class="btn btn-primary" onclick="printReceipt('${order.Order_ID}')">
                                <i class="fas fa-print"></i> Print Receipt
                            </button>
                            <button class="btn btn-outline" onclick="hideOrderDetail()">
                                Tutup
                            </button>
                        </div>
                    `;
                    
                    modal.classList.add('active');
                } else {
                    showToast('Order tidak ditemukan: ' + response.message, 'error');
                }
            } catch (error) {
                console.error('Error viewing order:', error);
                showToast('Error memuat detail order: ' + error.message, 'error');
            } finally {
                showLoader(false);
            }
        }

        function hideOrderDetail() {
            document.getElementById('order-detail-modal').classList.remove('active');
        }

        function filterOrders() {
            loadOrders();
        }

        function refreshOrders() {
            loadOrders();
        }
        
        // ==================== STATUS MANAGEMENT ====================
        function showStatusModal(orderId) {
            const order = simulatedDatabase.orders.find(o => o.Order_ID === orderId);
            if (order) {
                document.getElementById('status-order-id').value = orderId;
                document.getElementById('status-select').value = order.Status;
                document.getElementById('status-modal').classList.add('active');
            }
        }
        
        function hideStatusModal() {
            document.getElementById('status-modal').classList.remove('active');
        }
        
        async function updateOrderStatus() {
            const orderId = document.getElementById('status-order-id').value;
            const status = document.getElementById('status-select').value;
            const notes = document.getElementById('status-notes').value;
            
            try {
                showLoader(true);
                
                const response = await simulatedAPI('update_order_status', {
                    orderId: orderId,
                    status: status,
                    notes: notes
                });
                
                if (response.success) {
                    showToast('Status order berhasil diupdate', 'success');
                    hideStatusModal();
                    loadOrders();
                    if (state.currentSection === 'dashboard') {
                        loadDashboard();
                    }
                } else {
                    showToast('Gagal mengupdate status: ' + response.message, 'error');
                }
            } catch (error) {
                console.error('Error updating order status:', error);
                showToast('Error mengupdate status: ' + error.message, 'error');
            } finally {
                showLoader(false);
            }
        }
        
        // ==================== PAYMENT MANAGEMENT ====================
        function showPaymentModal(orderId) {
            const order = simulatedDatabase.orders.find(o => o.Order_ID === orderId);
            if (order) {
                document.getElementById('payment-order-id').value = orderId;
                document.getElementById('payment-method').value = order.Metode_Bayar || '';
                document.getElementById('payment-status').value = order.Status_Bayar || 'Belum_Bayar';
                document.getElementById('payment-modal').classList.add('active');
            }
        }
        
        function hidePaymentModal() {
            document.getElementById('payment-modal').classList.remove('active');
        }
        
        async function updatePayment() {
            const orderId = document.getElementById('payment-order-id').value;
            const paymentData = {
                method: document.getElementById('payment-method').value,
                status: document.getElementById('payment-status').value,
                notes: document.getElementById('payment-notes').value
            };
            
            try {
                showLoader(true);
                
                const response = await simulatedAPI('update_payment', {
                    orderId: orderId,
                    paymentData: paymentData
                });
                
                if (response.success) {
                    showToast('Pembayaran berhasil diupdate', 'success');
                    hidePaymentModal();
                    loadOrders();
                } else {
                    showToast('Gagal mengupdate pembayaran: ' + response.message, 'error');
                }
            } catch (error) {
                console.error('Error updating payment:', error);
                showToast('Error mengupdate pembayaran: ' + error.message, 'error');
            } finally {
                showLoader(false);
            }
        }

        // ==================== MANUAL ORDER ====================
        function calculateManualTotal() {
            const servicesText = document.getElementById('manual-services').value;
            const discount = parseFloat(document.getElementById('manual-discount').value) || 0;
            const additionalFees = parseFloat(document.getElementById('manual-additional-fees').value) || 0;
            
            // Parse services from text
            const services = [];
            let subtotal = 0;
            
            const lines = servicesText.split('\n').filter(line => line.trim());
            lines.forEach(line => {
                const match = line.match(/(\d+\.)?\s*(.+?)\s*-\s*Rp?\s*([\d.,]+)/i);
                if (match) {
                    const serviceName = match[2].trim();
                    const price = parseFloat(match[3].replace(/[.,]/g, ''));
                    services.push({ nama: serviceName, harga: price });
                    subtotal += price;
                }
            });
            
            const total = Math.max(0, subtotal - discount + additionalFees);
            
            const display = document.getElementById('manual-total-display');
            const summary = document.getElementById('manual-summary');
            
            summary.innerHTML = `
                <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Subtotal:</span>
                        <span>Rp ${formatNumber(subtotal)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Diskon:</span>
                        <span>- Rp ${formatNumber(discount)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Biaya Tambahan:</span>
                        <span>+ Rp ${formatNumber(additionalFees)}</span>
                    </div>
                    <hr style="margin: 10px 0;">
                    <div style="display: flex; justify-content: space-between; font-weight: 600; font-size: 1.1em;">
                        <span>Total:</span>
                        <span>Rp ${formatNumber(total)}</span>
                    </div>
                    <div style="margin-top: 15px; font-size: 0.9em; color: #64748b;">
                        ${services.length} layanan ditemukan
                    </div>
                </div>
            `;
            
            display.style.display = 'block';
        }

        async function submitManualOrder() {
            const customerName = document.getElementById('manual-customer-name').value.trim();
            const customerPhone = document.getElementById('manual-customer-phone').value.trim();
            const servicesText = document.getElementById('manual-services').value.trim();
            
            if (!customerName || !customerPhone || !servicesText) {
                showToast('Nama, WhatsApp, dan layanan harus diisi', 'error');
                return;
            }
            
            // Parse services
            const services = [];
            const lines = servicesText.split('\n').filter(line => line.trim());
            lines.forEach(line => {
                const match = line.match(/(\d+\.)?\s*(.+?)\s*-\s*Rp?\s*([\d.,]+)/i);
                if (match) {
                    const serviceName = match[2].trim();
                    const price = parseFloat(match[3].replace(/[.,]/g, ''));
                    services.push({ nama: serviceName, harga: price });
                }
            });
            
            if (services.length === 0) {
                showToast('Format layanan tidak valid', 'error');
                return;
            }
            
            const orderData = {
                customer_name: customerName,
                customer_phone: customerPhone,
                customer_address: document.getElementById('manual-customer-address').value.trim(),
                services: services,
                category: document.getElementById('manual-category').value,
                discount: parseFloat(document.getElementById('manual-discount').value) || 0,
                additional_fees: parseFloat(document.getElementById('manual-additional-fees').value) || 0,
                status: document.getElementById('manual-status').value,
                payment_method: document.getElementById('manual-payment-method').value,
                payment_status: document.getElementById('manual-payment-status').value,
                admin_notes: document.getElementById('manual-admin-notes').value.trim(),
                customer_notes: document.getElementById('manual-customer-notes').value.trim()
            };
            
            try {
                showLoader(true);
                
                const response = await simulatedAPI('create_manual_order', { orderData: orderData });
                
                if (response.success) {
                    showToast(`Order manual berhasil dibuat! ID: ${response.order_id}`, 'success');
                    
                    // Reset form
                    const formElements = [
                        'manual-customer-name',
                        'manual-customer-phone',
                        'manual-customer-address',
                        'manual-services',
                        'manual-discount',
                        'manual-additional-fees',
                        'manual-admin-notes',
                        'manual-customer-notes'
                    ];
                    
                    formElements.forEach(id => {
                        document.getElementById(id).value = '';
                    });
                    
                    document.getElementById('manual-total-display').style.display = 'none';
                    document.getElementById('manual-payment-method').value = '';
                    document.getElementById('manual-payment-status').value = 'Belum_Bayar';
                    document.getElementById('manual-status').value = 'Pending';
                    
                    // Switch to orders section
                    showSection('orders');
                    loadOrders();
                } else {
                    showToast('Gagal membuat order: ' + (response.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error creating manual order:', error);
                showToast('Error membuat order manual: ' + error.message, 'error');
            } finally {
                showLoader(false);
            }
        }
        
        // ==================== DISCOUNT MANAGEMENT ====================
        async function loadDiscounts() {
            try {
                showLoader(true);
                
                const response = await simulatedAPI('get_discounts');
                
                if (response.success) {
                    state.discounts = response.data || [];
                    renderDiscountsTable();
                } else {
                    showToast('Gagal memuat diskon: ' + response.message, 'error');
                }
            } catch (error) {
                console.error('Error loading discounts:', error);
                showToast('Error memuat diskon: ' + error.message, 'error');
            } finally {
                showLoader(false);
            }
        }
        
        function renderDiscountsTable() {
            const tbody = document.querySelector('#discounts-table tbody');
            
            if (!state.discounts || state.discounts.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="text-center">Tidak ada diskon</td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = state.discounts.map(discount => {
                const nilai = discount.Tipe === 'persen' ? `${discount.Nilai}%` : `Rp ${formatNumber(discount.Nilai)}`;
                const startDate = discount.Berlaku_Mulai ? new Date(discount.Berlaku_Mulai) : new Date();
                const endDate = discount.Berlaku_Hingga ? new Date(discount.Berlaku_Hingga) : new Date();
                
                return `
                    <tr>
                        <td><strong>${discount.Kode}</strong></td>
                        <td>${discount.Tipe === 'persen' ? 'Persentase' : 'Nominal'}</td>
                        <td>${nilai}</td>
                        <td>Rp ${formatNumber(discount.Min_Order || 0)}</td>
                        <td>Rp ${formatNumber(discount.Maks_Diskon || 0)}</td>
                        <td>${startDate.toLocaleDateString('id-ID')}</td>
                        <td>${endDate.toLocaleDateString('id-ID')}</td>
                        <td>
                            <span class="badge ${discount.Status === 'active' ? 'badge-success' : 'badge-danger'}">
                                ${discount.Status === 'active' ? 'Aktif' : 'Nonaktif'}
                            </span>
                        </td>
                        <td>${discount.Digunakan || 0}</td>
                        <td>
                            <button class="btn btn-sm btn-outline" onclick="editDiscount('${discount.Kode}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline" onclick="deleteDiscount('${discount.Kode}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function showDiscountForm(discountCode = null) {
            const modal = document.getElementById('discount-form-modal');
            const title = document.getElementById('discount-form-title');
            const form = document.getElementById('discount-form');
            
            if (discountCode) {
                title.textContent = 'Edit Diskon';
                const discount = state.discounts.find(d => d.Kode === discountCode);
                if (discount) {
                    document.getElementById('discount-id').value = discount.Kode;
                    document.getElementById('discount-code').value = discount.Kode;
                    document.getElementById('discount-type').value = discount.Tipe;
                    document.getElementById('discount-value').value = discount.Nilai;
                    document.getElementById('discount-min-order').value = discount.Min_Order || '';
                    document.getElementById('discount-max-discount').value = discount.Maks_Diskon || '';
                    document.getElementById('discount-status').value = discount.Status;
                    
                    const startDate = discount.Berlaku_Mulai ? new Date(discount.Berlaku_Mulai).toISOString().split('T')[0] : '';
                    const endDate = discount.Berlaku_Hingga ? new Date(discount.Berlaku_Hingga).toISOString().split('T')[0] : '';
                    
                    document.getElementById('discount-start-date').value = startDate;
                    document.getElementById('discount-end-date').value = endDate;
                }
            } else {
                title.textContent = 'Tambah Diskon Baru';
                form.reset();
                document.getElementById('discount-id').value = '';
                // Set default dates
                const today = new Date().toISOString().split('T')[0];
                const nextMonth = new Date();
                nextMonth.setMonth(nextMonth.getMonth() + 1);
                const nextMonthStr = nextMonth.toISOString().split('T')[0];
                
                document.getElementById('discount-start-date').value = today;
                document.getElementById('discount-end-date').value = nextMonthStr;
                document.getElementById('discount-status').value = 'active';
                document.getElementById('discount-type').value = 'persen';
            }
            
            modal.classList.add('active');
        }
        
        function hideDiscountForm() {
            document.getElementById('discount-form-modal').classList.remove('active');
        }
        
        async function saveDiscount() {
            const form = document.getElementById('discount-form');
            const discountCode = document.getElementById('discount-id').value;
            
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const discountData = {
                code: document.getElementById('discount-code').value,
                type: document.getElementById('discount-type').value,
                value: parseFloat(document.getElementById('discount-value').value),
                min_order: parseFloat(document.getElementById('discount-min-order').value) || 0,
                max_discount: parseFloat(document.getElementById('discount-max-discount').value) || 0,
                start_date: document.getElementById('discount-start-date').value,
                end_date: document.getElementById('discount-end-date').value,
                status: document.getElementById('discount-status').value
            };
            
            try {
                showLoader(true);
                
                const action = discountCode ? 'update_discount' : 'add_discount';
                const params = discountCode ? 
                    { code: discountCode, updates: discountData } : 
                    { discount: discountData };
                
                const response = await simulatedAPI(action, params);
                
                if (response.success) {
                    showToast('Diskon berhasil disimpan', 'success');
                    hideDiscountForm();
                    loadDiscounts();
                } else {
                    showToast('Gagal menyimpan: ' + (response.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error saving discount:', error);
                showToast('Error menyimpan diskon: ' + error.message, 'error');
            } finally {
                showLoader(false);
            }
        }
        
        async function deleteDiscount(code) {
            if (!confirm('Yakin ingin menghapus diskon ini?')) return;
            
            try {
                showLoader(true);
                
                const response = await simulatedAPI('update_discount', {
                    code: code,
                    updates: { Status: 'inactive' }
                });
                
                if (response.success) {
                    showToast('Diskon berhasil dinonaktifkan', 'success');
                    loadDiscounts();
                } else {
                    showToast('Gagal menghapus: ' + response.message, 'error');
                }
            } catch (error) {
                console.error('Error deleting discount:', error);
                showToast('Error menghapus diskon: ' + error.message, 'error');
            } finally {
                showLoader(false);
            }
        }
        
        function editDiscount(code) {
            showDiscountForm(code);
        }
        
        function refreshDiscounts() {
            loadDiscounts();
        }
        
        // ==================== REPORTS ====================
        async function loadReports() {
            try {
                showLoader(true);
                
                const period = document.getElementById('report-period')?.value || 'today';
                const response = await simulatedAPI('get_reports', { period: period });
                
                if (response.success) {
                    renderReports(response.data || {});
                } else {
                    showToast('Gagal memuat laporan: ' + response.message, 'error');
                }
            } catch (error) {
                console.error('Error loading reports:', error);
                showToast('Error memuat laporan: ' + error.message, 'error');
            } finally {
                showLoader(false);
            }
        }
        
        function renderReports(data) {
            // Update stats cards
            document.getElementById('report-orders').textContent = data.total_orders || 0;
            document.getElementById('report-revenue').textContent = 'Rp ' + formatNumber(data.total_revenue || 0);
            document.getElementById('report-avg').textContent = 'Rp ' + formatNumber(data.average_order || 0);
            document.getElementById('report-services').textContent = data.services_sold || 0;
            
            // Update top services table
            const tbody = document.querySelector('#top-services-table tbody');
            const topServices = data.top_services || [];
            
            if (topServices.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="3" class="text-center">Tidak ada data</td>
                    </tr>
                `;
            } else {
                tbody.innerHTML = topServices.map(service => `
                    <tr>
                        <td>${service.name || service.nama}</td>
                        <td>${service.count || 0}</td>
                        <td>Rp ${formatNumber(service.revenue || 0)}</td>
                    </tr>
                `).join('');
            }
        }
        
        // ==================== SETTINGS ====================
        function loadSettings() {
            const settings = simulatedDatabase.settings;
            document.getElementById('company-name').value = settings.company_name;
            document.getElementById('company-phone').value = settings.company_phone;
            document.getElementById('company-email').value = settings.company_email;
            document.getElementById('company-address').value = settings.company_address;
            document.getElementById('receipt-prefix').value = settings.receipt_prefix;
            document.getElementById('auto-backup').value = settings.auto_backup.toString();
        }
        
        async function saveSettings() {
            try {
                showLoader(true);
                
                simulatedDatabase.settings = {
                    company_name: document.getElementById('company-name').value,
                    company_phone: document.getElementById('company-phone').value,
                    company_email: document.getElementById('company-email').value,
                    company_address: document.getElementById('company-address').value,
                    receipt_prefix: document.getElementById('receipt-prefix').value,
                    auto_backup: document.getElementById('auto-backup').value === 'true'
                };
                
                saveToLocalStorage();
                
                showToast('Pengaturan berhasil disimpan', 'success');
            } catch (error) {
                console.error('Error saving settings:', error);
                showToast('Error menyimpan pengaturan: ' + error.message, 'error');
            } finally {
                showLoader(false);
            }
        }

        // ==================== UTILITY FUNCTIONS ====================
        function formatNumber(num) {
            return new Intl.NumberFormat('id-ID').format(num || 0);
        }

        function getStatusBadgeClass(status) {
            if (!status) return 'badge-info';
            
            switch(status.toLowerCase()) {
                case 'selesai': return 'badge-success';
                case 'diproses': return 'badge-warning';
                case 'dikonfirmasi': return 'badge-info';
                case 'pending': return 'badge-info';
                case 'menunggu_part': return 'badge-warning';
                case 'dibatalkan': return 'badge-danger';
                default: return 'badge-info';
            }
        }

        function getPaymentBadgeClass(status) {
            if (!status) return 'badge-info';
            
            switch(status) {
                case 'Lunas': return 'badge-success';
                case 'DP_50%': return 'badge-warning';
                case 'Gratis': return 'badge-info';
                case 'Belum_Bayar': return 'badge-danger';
                default: return 'badge-info';
            }
        }

        async function printReceipt(orderId) {
            try {
                const response = await simulatedAPI('print_receipt', { orderId: orderId });
                
                if (response.success && response.html_receipt) {
                    // Open receipt in new window for printing
                    const printWindow = window.open('', '_blank');
                    printWindow.document.write(response.html_receipt);
                    printWindow.document.close();
                    
                    setTimeout(() => {
                        printWindow.print();
                    }, 500);
                } else {
                    showToast('Gagal mencetak receipt: ' + response.message, 'error');
                }
            } catch (error) {
                console.error('Error printing receipt:', error);
                showToast('Error mencetak receipt: ' + error.message, 'error');
            }
        }

        function showNotifications() {
            // Simple notification display
            const pendingCount = document.getElementById('pending-orders').textContent || 0;
            alert(`Notifikasi:\n1. ${pendingCount} order pending\n2. Backup otomatis berjalan\n3. Sistem berjalan normal`);
        }

        // ==================== GLOBAL FUNCTIONS ====================
        window.showSection = showSection;
        window.toggleTheme = toggleTheme;
        window.logout = logout;
        window.showServiceForm = showServiceForm;
        window.hideServiceForm = hideServiceForm;
        window.saveService = saveService;
        window.editService = editService;
        window.deleteService = deleteService;
        window.refreshServices = refreshServices;
        window.viewOrderDetail = viewOrderDetail;
        window.hideOrderDetail = hideOrderDetail;
        window.filterOrders = filterOrders;
        window.refreshOrders = refreshOrders;
        window.calculateManualTotal = calculateManualTotal;
        window.submitManualOrder = submitManualOrder;
        window.printReceipt = printReceipt;
        window.showNotifications = showNotifications;
        window.showDiscountForm = showDiscountForm;
        window.hideDiscountForm = hideDiscountForm;
        window.saveDiscount = saveDiscount;
        window.editDiscount = editDiscount;
        window.deleteDiscount = deleteDiscount;
        window.refreshDiscounts = refreshDiscounts;
        window.showPaymentModal = showPaymentModal;
        window.hidePaymentModal = hidePaymentModal;
        window.updatePayment = updatePayment;
        window.showStatusModal = showStatusModal;
        window.hideStatusModal = hideStatusModal;
        window.updateOrderStatus = updateOrderStatus;
        window.loadReports = loadReports;
        window.saveSettings = saveSettings;
    </script>
</body>
</html>

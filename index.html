<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- SEO Meta Description -->
    <meta name="description" content="Butuh servis elektronik cepat di Semarang? Malik Service ahli perbaikan AC, Kulkas, Mesin Cuci, HP & Laptop. Melayani Pickup & Antar. Cek estimasi biaya dan booking sekarang!">
    <title>Malik Service Center</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #10b981;
            --dark-bg: #0f172a;
            --dark-card: #1e293b;
            --light-bg: #f8fafc;
            --light-card: #ffffff;
            --text-main: #334155;
            --text-light: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 12px;
            --transition: all 0.3s ease;
        }

        body.dark-mode {
            --light-bg: #0f172a;
            --light-card: #1e293b;
            --text-main: #f1f5f9;
            --text-light: #94a3b8;
            --border: #334155;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }

        body {
            background-color: var(--light-bg);
            color: var(--text-main);
            transition: var(--transition);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding-bottom: 80px; /* Space for floating button if needed */
        }

        /* HEADER */
        header {
            background: var(--light-card);
            padding: 1rem 5%;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .brand { font-size: 1.25rem; font-weight: 700; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        
        /* MAIN CONTAINER */
        main { max-width: 600px; margin: 2rem auto; padding: 0 1.5rem; flex: 1; }

        /* SECTIONS */
        .step-section {
            background: var(--light-card);
            padding: 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: none;
            animation: fadeIn 0.5s ease;
        }
        .step-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h2 { margin-bottom: 1.5rem; color: var(--primary); font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
        p.subtitle { color: var(--text-light); margin-bottom: 2rem; font-size: 0.95rem; }

        /* FORMS */
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.9rem; }
        input[type="text"], input[type="password"], input[type="tel"], input[type="date"], input[type="number"], select, textarea {
            width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px;
            background: var(--light-bg); color: var(--text-main); font-size: 1rem;
        }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); }
        input[readonly] { background-color: #e2e8f0; color: #64748b; cursor: default; }

        /* BUTTONS */
        .btn { flex: 1; padding: 12px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; transition: var(--transition); display: flex; justify-content: center; align-items: center; gap: 8px; font-size: 0.95rem; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-primary:disabled { background: #94a3b8; cursor: not-allowed; }
        .btn-secondary { background: #64748b; color: white; }
        .btn-secondary:hover { background: #475569; }
        .btn-whatsapp { background: #25D366; color: white; }
        .btn-whatsapp:hover { background: #1ebc57; }
        .btn-success { background: var(--secondary); color: white; }
        
        .nav-buttons { display: flex; justify-content: space-between; margin-top: 2rem; gap: 1rem; }
        .full-width { width: 100%; margin-bottom: 10px; }

        /* HERO SPECIFIC */
        .hero-section { text-align: center; padding: 2rem 1.5rem; }
        .hero-icon { font-size: 3rem; color: var(--primary); margin-bottom: 1rem; }
        .cta-btn { background: var(--primary); color: white; padding: 1rem 2rem; border: none; border-radius: 50px; font-size: 1rem; font-weight: 600; cursor: pointer; width: 100%; display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 1rem; }
        
        /* SERVICE GRID (Updated) */
        .service-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .service-card { 
            background: var(--light-bg); border: 1px solid var(--border); padding: 15px; 
            border-radius: 8px; text-align: center; cursor: pointer; transition: 0.2s;
        }
        .service-card:hover { border-color: var(--primary); background: #eff6ff; }
        .service-card i { font-size: 1.5rem; color: var(--primary); margin-bottom: 8px; display: block; }
        .service-card span { font-size: 0.85rem; font-weight: 600; }

        /* PICKUP BOX */
        .pickup-box {
            background-color: #e0f2fe;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            margin-bottom: 15px;
            display: none; /* Hidden by default */
        }
        body.dark-mode .pickup-box {
            background-color: #1e3a8a;
            border-left-color: #60a5fa;
        }
        
        /* ARTICLE SECTION STYLES */
        #article-section { max-width: 800px; } /* Lebih lebar untuk bacaan */
        .article-content { text-align: justify; }
        .article-content h1 { 
            color: var(--primary); 
            font-size: 1.8rem; 
            margin-bottom: 1.5rem; 
            line-height: 1.3;
            text-align: center;
        }
        .article-content h2 { 
            display: block; /* Override icon style */
            color: var(--text-main); 
            font-size: 1.4rem; 
            margin-top: 2rem; 
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
        }
        .article-content p { margin-bottom: 1.2rem; font-size: 1rem; color: var(--text-main); }
        .article-content ul { margin-bottom: 1.5rem; padding-left: 1.5rem; color: var(--text-main); }
        .article-content li { margin-bottom: 0.5rem; }
        .article-faq-item { background: var(--light-bg); padding: 1rem; border-radius: 8px; margin-bottom: 10px; border: 1px solid var(--border); }
        .article-faq-item strong { display: block; color: var(--primary); margin-bottom: 5px; }

        /* ADMIN RECEIPT STYLES */
        .admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .full-col { grid-column: span 2; }
        
        /* PRICE SUMMARY BOX */
        .price-summary {
            background-color: var(--primary);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            animation: fadeIn 0.3s;
        }
        .price-row { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.9rem; }
        .price-total { border-top: 1px solid rgba(255,255,255,0.3); margin-top: 8px; padding-top: 8px; font-weight: bold; font-size: 1.1rem; display: flex; justify-content: space-between; }

        /* PRINT PREVIEW / RECEIPT CARD */
        #receiptPreview {
            background: white; color: black; width: 100%; max-width: 380px;
            padding: 20px; font-family: 'Courier New', Courier, monospace;
            border: 1px solid #ccc; margin: 20px auto; border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: block;
        }
        
        .receipt-header { text-align: center; border-bottom: 2px dashed #000; padding-bottom: 15px; margin-bottom: 15px; }
        .receipt-logo { 
            font-size: 2.5rem; 
            color: #2563eb !important;
            display: inline-block; 
            margin-bottom: 5px; 
            -webkit-print-color-adjust: exact; 
            print-color-adjust: exact; 
        }
        .receipt-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem; }
        .receipt-divider { border-top: 2px dashed #000; margin: 15px 0; }
        .receipt-total { font-weight: bold; font-size: 1.1rem; display: flex; justify-content: space-between; }

        /* TOAST */
        .toast { position: fixed; top: 20px; right: 20px; background: #ef4444; color: white; padding: 1rem; border-radius: 8px; z-index: 200; display: none; animation: slideIn 0.3s; text-align:center; box-shadow: 0 4px 10px rgba(0,0,0,0.2); max-width: 80%; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        /* FLOATING WA BUTTON */
        .fab-wa {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background-color: #25D366;
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: 999;
            text-decoration: none;
            transition: transform 0.2s;
        }
        .fab-wa:hover { transform: scale(1.1); }

        /* PRINT MEDIA */
        @media print {
            body * { visibility: hidden; }
            #receiptPreview, #receiptPreview * { visibility: visible; }
            #receiptPreview { position: absolute; left: 0; top: 0; width: 100%; max-width: 100%; margin: 0; padding: 0; box-shadow: none; border: none; color: black !important; }
            .no-print { display: none !important; }
            .fab-wa { display: none !important; }
        }

        /* Responsive */
        @media(max-width: 480px) { 
            .admin-grid { grid-template-columns: 1fr; } 
            .full-col { grid-column: span 1; } 
            .article-content h1 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>

    <header>
        <div class="brand"><i class="fa-solid fa-screwdriver-wrench"></i> Malik Service</div>
        <button id="darkModeBtn" style="background:none; border:none; color:var(--text-main); cursor:pointer;"><i class="fa-solid fa-moon"></i></button>
    </header>

    <!-- FLOATING WA -->
    <a href="https://wa.me/6285713087659" class="fab-wa" target="_blank">
        <i class="fa-brands fa-whatsapp"></i>
    </a>

    <div id="toast" class="toast"></div>

    <main>
        <!-- 1. LOGIN ADMIN -->
        <section id="login-section" class="step-section active">
            <h2><i class="fa-solid fa-lock"></i> Login Admin</h2>
            <p class="subtitle">Masuk untuk membuat Resi Manual.</p>
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="adminUser" placeholder="Masukan username">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="adminPass" placeholder="Masukan password">
            </div>
            <button id="btnLogin" class="btn btn-primary full-width" onclick="handleLogin()">
                <span>Masuk Panel Admin</span>
            </button>
            <button class="btn btn-secondary full-width" onclick="goToCustomerView()">Ke Halaman Pelanggan</button>
        </section>

        <!-- 2. ADMIN PANEL -->
        <section id="admin-panel" class="step-section">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                <h2 style="margin:0;"><i class="fa-solid fa-file-invoice"></i> Buat Resi Manual</h2>
                <button class="btn btn-secondary" onclick="logout()" style="padding:5px 10px; font-size:0.8rem;">Keluar</button>
            </div>
            
            <div class="admin-grid">
                <div class="form-group full-col">
                    <label>Nomor Order / Resi</label>
                    <input type="text" id="resOrderId" placeholder="Otomatis saat Login" readonly>
                </div>
                <div class="form-group">
                    <label>Tanggal</label>
                    <input type="date" id="resDate" onchange="updateLivePreview()">
                </div>
                <div class="form-group">
                    <label>Nama Pelanggan</label>
                    <input type="text" id="resName" placeholder="Nama Customer" oninput="updateLivePreview()">
                </div>
                <div class="form-group">
                    <label>No. HP / WA</label>
                    <input type="text" id="resWA" placeholder="08..." oninput="updateLivePreview()">
                </div>
                <div class="form-group">
                    <label>Perangkat</label>
                    <input type="text" id="resDevice" placeholder="HP/Laptop" oninput="updateLivePreview()">
                </div>
                <div class="form-group">
                    <label>Merek/Model</label>
                    <input type="text" id="resModel" placeholder="Samsung A52" oninput="updateLivePreview()">
                </div>
                <div class="form-group full-col">
                    <label>Keluhan / Kerusakan</label>
                    <textarea id="resIssue" rows="2" placeholder="Deskripsi kerusakan..." oninput="updateLivePreview()"></textarea>
                </div>
                <div class="form-group full-col">
                    <label>Layanan & Biaya ( Manual Entry )</label>
                    <textarea id="resServices" rows="3" placeholder="Ganti LCD - 500000&#10;Ganti Baterai - 250000" oninput="updateLivePreview()"></textarea>
                </div>
            </div>

            <div style="margin-top: 2rem; display: flex; flex-direction: column; gap: 10px;">
                <button class="btn btn-primary full-width" onclick="printReceipt()">
                    <i class="fa-solid fa-print"></i> Cetak Resi (Printer)
                </button>
                <button id="btnDownload" class="btn btn-success full-width" onclick="downloadReceiptImage()">
                    <i class="fa-solid fa-download"></i> Download Resi (Gambar)
                </button>
                <!-- Tombol Cadangan Jika Download Gagal -->
                <button class="btn btn-secondary full-width" onclick="copyReceiptText()">
                    <i class="fa-solid fa-copy"></i> Salin Teks Resi (Cadangan)
                </button>
            </div>

            <div class="receipt-divider"></div>
            <h4 style="text-align:center; color:var(--text-light);">Preview Tampilan:</h4>
            
            <div id="receiptPreview">
                <div class="receipt-header">
                    <i class="fa-solid fa-screwdriver-wrench receipt-logo"></i>
                    <div style="font-weight:bold; font-size:1.2rem; text-transform:uppercase;">MALIK SERVICE</div>
                    <div style="font-size:0.8rem;"> DS.JamalSari RT004/RW002 No.52 Jl.Untung Suropati, Kota Semarang </div>
                    <div style="font-size:0.8rem;">WA: 0857-1308-7659</div>
                </div>
                <div class="receipt-row"><span>No. Order:</span><span id="prevId">-</span></div>
                <div class="receipt-row"><span>Tanggal:</span><span id="prevDate">-</span></div>
                <div class="receipt-divider"></div>
                <div class="receipt-row"><span>Pelanggan:</span><span id="prevName">-</span></div>
                <div class="receipt-row"><span>No. HP:</span><span id="prevWA">-</span></div>
                <div class="receipt-divider"></div>
                <div class="receipt-row"><span>Perangkat:</span><span id="prevDevice">-</span></div>
                <div class="receipt-row"><span>Model:</span><span id="prevModel">-</span></div>
                <div class="receipt-row" style="flex-direction:column;">
                    <span style="font-weight:bold; margin-bottom:2px;">Keluhan:</span>
                    <span id="prevIssue" style="font-size:0.8rem; text-align:right;">-</span>
                </div>
                <div class="receipt-divider"></div>
                <div style="font-weight:bold; margin-bottom:5px;">Rincian Layanan:</div>
                <div id="prevServices">
                    <div style="font-size:0.8rem; text-align:center;">Belum ada data</div>
                </div>
                <div class="receipt-divider"></div>
                <div class="receipt-total">
                    <span>TOTAL:</span>
                    <span id="prevTotal">Rp 0</span>
                </div>
                <div class="receipt-footer" style="text-align:center; margin-top:15px; font-size:0.7rem;">
                    <p>*Simpan struk ini sebagai bukti garansi.</p>
                    <p>Terima Kasih</p>
                </div>
            </div>
        </section>

        <!-- 3. CUSTOMER ORDER HERO -->
        <section id="customer-hero" class="step-section hero-section">
            <i class="fa-solid fa-microchip hero-icon"></i>
            <h1>Malik Service Center</h1>
            <p class="subtitle">Solusi perbaikan HP, Laptop & Elektronik Terpercaya.</p>
            
            <!-- Quick Service Grid -->
            <div class="service-grid">
                <div class="service-card" onclick="selectQuickService('HP', 'Layar pecah / blank')">
                    <i class="fa-solid fa-mobile-screen"></i>
                    <span>Ganti LCD</span>
                </div>
                <div class="service-card" onclick="selectQuickService('HP', 'Baterai Drop')">
                    <i class="fa-solid fa-battery-full"></i>
                    <span>Baterai Baru</span>
                </div>
                <div class="service-card" onclick="selectQuickService('Laptop', 'Overheat / Mati')">
                    <i class="fa-solid fa-laptop"></i>
                    <span>Servis Laptop</span>
                </div>
                <div class="service-card" onclick="selectQuickService('HP', 'Kena Air')">
                    <i class="fa-solid fa-droplet"></i>
                    <span>Water Damage</span>
                </div>
            </div>
            
            <button class="cta-btn" onclick="startCustomerOrder()">
                Buat Order Servis Sekarang <i class="fa-solid fa-arrow-right"></i>
            </button>
            
            <button class="btn btn-secondary full-width" onclick="showArticle()">
                <i class="fa-solid fa-book-open"></i> Baca Artikel & Tips
            </button>

            <button class="btn btn-secondary full-width" onclick="showLogin()" style="margin-top:10px;">
                <i class="fa-solid fa-lock"></i> Login Admin (Area Khusus)
            </button>
        </section>
        
        <!-- 4. FORM ORDER PELANGGAN -->
        <section id="customer-form" class="step-section">
            <h2><i class="fa-solid fa-wrench"></i> Detail Kerusakan</h2>
            <p class="subtitle">Pilih jenis perangkat dan kerusakan untuk estimasi biaya.</p>

            <!-- DATABASE SELECTION -->
            <div class="form-group">
                <label>Kategori Perangkat</label>
                <select id="custCategory" onchange="populateServiceDropdown()">
                    <option value="">-- Pilih Kategori --</option>
                    <!-- Options populated by JS -->
                </select>
            </div>

            <div class="form-group">
                <label>Komponen & Kerusakan</label>
                <select id="custService" onchange="updatePriceSummary()">
                    <option value="">-- Pilih Kerusakan --</option>
                    <!-- Options populated by JS -->
                </select>
            </div>

            <!-- PICKUP & ANTAR SECTION (BARU) -->
            <div class="form-group">
                <label style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                    <input type="checkbox" id="needPickup" style="width:auto;" onchange="togglePickupInput()">
                    Butuh Jemput Unit (Pickup & Antar)?
                </label>
            </div>

            <div id="pickupInputGroup" class="pickup-box">
                <label>Jarak Lokasi (km)</label>
                <input type="number" id="pickupDistance" placeholder="Contoh: 3" oninput="updatePriceSummary()">
                <small id="pickupFeeText" style="display:block; margin-top:5px; color:var(--primary); font-weight:600;">
                    Biaya Pickup: Rp 0
                </small>
                <small style="display:block; margin-top:2px; font-size:0.75rem;">
                    *Biaya tetap Rp 25.000 untuk jarak < 5km. > 5km hubungi admin.
                </small>
            </div>

            <!-- PRICE SUMMARY DISPLAY -->
            <div id="priceDisplay" class="price-summary">
                <div style="font-weight:bold; margin-bottom:10px; border-bottom:1px solid rgba(255,255,255,0.2); padding-bottom:5px;">Rincian Biaya:</div>
                <div class="price-row">
                    <span>Harga Sparepart:</span>
                    <span id="dispSparepart">Rp 0</span>
                </div>
                <div class="price-row">
                    <span>Biaya Jasa:</span>
                    <span id="dispService">Rp 0</span>
                </div>
                <div class="price-row" id="pickupRow" style="display:none; color:#fef08a;">
                    <span>Biaya Pickup:</span>
                    <span id="dispPickup">Rp 0</span>
                </div>
                <div class="price-total">
                    <span>ESTIMASI TOTAL:</span>
                    <span id="dispTotal">Rp 0</span>
                </div>
                <div style="font-size:0.75rem; margin-top:8px; font-style:italic;">*Harga bisa berubah setelah pengecekan fisik.</div>
            </div>

            <div class="receipt-divider" style="margin: 20px 0;"></div>
            
            <h2><i class="fa-solid fa-user"></i> Data Diri</h2>
            <div class="form-group">
                <label>Nama Lengkap</label>
                <input type="text" id="custName" placeholder="Contoh: Budi Santoso">
            </div>
            <div class="form-group">
                <label>Nomor WhatsApp</label>
                <input type="tel" id="custWA" placeholder="0812...">
            </div>
            <div class="form-group">
                <label>Alamat / Detail Lokasi</label>
                <textarea id="custAddress" rows="2" placeholder="Alamat lengkap..."></textarea>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToCustomerView()">Batal</button>
                <button id="btnSendWA" class="btn btn-whatsapp" onclick="sendCustomerOrder(event)">
                    <i class="fa-brands fa-whatsapp"></i> Kirim Order ke WA
                </button>
            </div>
        </section>

        <!-- 5. HALAMAN ARTIKEL (BARU) -->
        <section id="article-section" class="step-section">
            <h2 style="justify-content: center;"><i class="fa-solid fa-newspaper"></i> Artikel & Tips</h2>
            
            <div class="article-content">
                <h1>Jasa Servis Elektronik Panggilan & Workshop Terbaik di Semarang</h1>

                <p>Pernahkah Anda mengalami kepanikan saat AC tiba-tiba mati di siang hari yang panas, atau mesin cuci berhenti bekerja saat tumpukan pakaian menumpuk? Masalah pada perangkat elektronik seringkali datang tak terduga dan mengganggu kenyamanan rumah Anda. Jangan biarkan kerusakan kecil mengganggu produktivitas dan kenyamanan keluarga. <strong>Malik Service</strong> hadir sebagai solusi terpercaya untuk segala kebutuhan perbaikan elektronik Anda di Semarang.</p>

                <p>Kami memahami bahwa elektronik bukan sekadar barang, melainkan investasi yang memudahkan hidup Anda. Oleh karena itu, Malik Service berkomitmen memberikan layanan perbaikan yang profesional, transparan, dan bergaransi. Baik Anda membutuhkan perbaikan untuk perangkat rumah tangga besar maupun gadget harian, teknisi kami siap memberikan penanganan terbaik.</p>

                <h2>Layanan Perbaikan Rumah Tangga Terlengkap</h2>
                
                <p>Elektronik rumah tangga seperti AC, kulkas, dan mesin cuci adalah tulang punggung kenyamanan di rumah. Kerusakan pada perangkat ini seringkali membutuhkan penanganan khusus. Di Malik Service, kami menangani berbagai masalah mulai dari yang ringan hingga berat.</p>

                <p>Untuk <strong>layanan AC</strong>, kami menawarkan perbaikan masalah seperti AC tidak dingin, bocor, hingga modul mati. Kami juga melayani cuci AC secara rutin untuk menjaga kinerja dan udara tetap sehat. Selain itu, spesialis <strong>kulkas</strong> kami siap menangani masalah freezer tidak beku, pendinginan tidak merata, atau bahkan penggantian kompresor. Jika mesin cuci Anda bermasalah, seperti tidak berputar, bocor, atau error pada modulnya, jangan ragu untuk mempercayakannya kepada kami. Teknisi kami berpengalaman dalam memperbaiki berbagai merek dan tipe mesin cuci.</p>

                <h2>Spesialis Gadget: HP, Laptop, dan PC</h2>

                <p>Selain peralatan rumah tangga, Malik Service juga menjadi andalan untuk perbaikan gadget. Di era digital ini, HP dan Laptop adalah alat kerja yang vital. Jika <strong>layar HP Anda pecah</strong>, baterai drop, atau mengalami masalah pada konektor cas, kami menyediakan suku cadang berkualitas dengan pengerjaan cepat.</p>

                <p>Kami juga melayani servis <strong>Laptop dan PC</strong> untuk berbagai kebutuhan, mulai dari penggantian keyboard, layar, upgrade SSD agar performa lebih kencang, hingga pembersihan thermal paste untuk mengatasi overheat. Bagi Anda yang menggunakan PC rakitan, kami juga menangani perbaikan motherboard, VGA card, dan power supply. Bahkan untuk perangkat TV yang mengalami dark screen atau suara hilang, kami memiliki solusi perbaikannya.</p>

                <h2>Kenapa Memilih Malik Service?</h2>

                <p>Memilih jasa servis elektronik sembarangan bisa berisiko merugikan Anda. Di Malik Service, kami mengedepankan kepuasan pelanggan melalui tiga nilai utama. Pertama adalah <strong>Transparansi Harga</strong>. Anda bisa melakukan estimasi biaya langsung melalui fitur di website kami sebelum memutuskan untuk memesan layanan, sehingga tidak ada biaya tersembunyi.</p>

                <p>Kedua, <strong>Teknisi Berpengalaman</strong>. Tim kami terdiri dari para ahli yang sudah berpengalaman menangani berbagai jenis kerusakan. Ketiga, <strong>Kemudahan Pemesanan</strong>. Anda tidak perlu repot datang ke bengkel; cukup isi formulir pemesanan di website ini, dan Anda bisa langsung terhubung dengan kami via WhatsApp untuk konsultasi lebih lanjut.</p>

                <h2>Tips Merawat Elektronik Agar Awet</h2>

                <p>Sebagai bentuk dedikasi kami kepada pelanggan, berikut adalah tips sederhana merawat elektronik Anda:</p>
                <ul>
                    <li><strong>AC dan Kulkas:</strong> Bersihkan filter AC secara berkala (minimal 3 bulan sekali) dan jangan menaruh makanan panas langsung ke dalam kulkas.</li>
                    <li><strong>HP dan Laptop:</strong> Hindari penggunaan saat sedang di-charge untuk menjaga kesehatan baterai, dan gunakan casing pelindung yang berkualitas.</li>
                    <li><strong>Mesin Cuci:</strong> Jangan membebani mesin cuci melebihi kapasitasnya dan pastikan selang pembuangan air tidak bengkok agar aliran lancar.</li>
                </ul>

                <h2>Pertanyaan yang Sering Diajukan (FAQ)</h2>

                <div class="article-faq-item">
                    <strong>Berapa lama waktu pengerjaan?</strong>
                    Waktu pengerjaan bervariasi tergantung tingkat kerusakan. Untuk kerusakan ringan seperti ganti kabel atau perbaikan kecil, bisa selesai di hari yang sama. Namun, untuk kerusakan berat yang membutuhkan penggantian suku cadang khusus, biasanya memakan waktu 2-3 hari.
                </div>

                <div class="article-faq-item">
                    <strong>Apakah ada garansi servis?</strong>
                    Ya, Malik Service memberikan garansi servis untuk setiap perbaikan yang dilakukan. Garansi mencakup jasa servis dan sparepart yang diganti, sesuai dengan ketentuan yang berlaku.
                </div>

                <div class="article-faq-item">
                    <strong>Apakah melayani panggilan ke rumah?</strong>
                    Saat ini, Anda dapat mengisi formulir di website kami untuk pemesanan dan konsultasi awal. Kami akan membantu Anda menentukan apakah perlu check-up unit di lokasi atau cukup dibawa ke workshop kami di DS. JamalSari untuk perbaikan yang lebih akurat.
                </div>

                <p style="text-align: center; margin-top: 2rem; font-weight: bold;">Jangan biarkan elektronik rusak menghambat aktivitas Anda. Percayakan perbaikan kepada ahli yang benar-benar mengerti kebutuhan Anda.</p>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="goToCustomerView()">Kembali ke Menu Utama</button>
                <button class="btn btn-whatsapp" onclick="window.location.href='https://wa.me/6285713087659'">
                    <i class="fa-brands fa-whatsapp"></i> Hubungi Kami Sekarang
                </button>
            </div>
        </section>

    </main>

    <!-- Library html2canvas -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <script>
        // ==========================================
        // KONFIGURASI BACKEND SPREADSHEET
        // ==========================================
        const SPREADSHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSMPwDhdP3zSLLz_VZrOUeLzWImUq2_aoc06Pwwe_t-5UAEBDnmClxXZ3FjJGm-p7bDFznhQ2CF74me/pub?gid=0&single=true&output=csv"; 
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxIVdXLb9UPX2LbG9wMe5eb_-W0rhxRGJF-TMbxgeNjH07UQI6j3AAW3ROBlc-9mmRU/exec";

        // ==========================================
        // DATABASE LAYANAN
        // ==========================================
        const serviceDatabase = [
            { cat: "HP", comp: "LCD", issue: "Layar pecah / blank", sparepart: 250000, jasa: 80000 },
            { cat: "HP", comp: "Touchscreen", issue: "Sentuh tidak responsif", sparepart: 150000, jasa: 70000 },
            { cat: "HP", comp: "Baterai", issue: "Drop / tidak mengisi", sparepart: 120000, jasa: 50000 },
            { cat: "HP", comp: "Konektor Cas", issue: "Tidak bisa charging", sparepart: 80000, jasa: 50000 },
            { cat: "HP", comp: "Speaker", issue: "Suara kecil / mati", sparepart: 60000, jasa: 50000 },
            { cat: "HP", comp: "Mic", issue: "Tidak bisa telpon", sparepart: 50000, jasa: 50000 },
            { cat: "HP", comp: "Kamera", issue: "Kamera blur / mati", sparepart: 90000, jasa: 60000 },
            { cat: "HP", comp: "Flex Volume", issue: "Tombol rusak", sparepart: 40000, jasa: 50000 },
            { cat: "HP", comp: "Flex Power", issue: "HP tidak bisa nyala", sparepart: 40000, jasa: 60000 },
            { cat: "HP", comp: "IC Power", issue: "Mati total", sparepart: 180000, jasa: 150000 },
            { cat: "Laptop", comp: "LCD Laptop", issue: "Layar pecah / garis", sparepart: 550000, jasa: 150000 },
            { cat: "Laptop", comp: "Keyboard", issue: "Tombol mati", sparepart: 300000, jasa: 120000 },
            { cat: "Laptop", comp: "Baterai Laptop", issue: "Tidak mengisi", sparepart: 350000, jasa: 120000 },
            { cat: "Laptop", comp: "SSD 256GB", issue: "Upgrade / rusak", sparepart: 400000, jasa: 100000 },
            { cat: "Laptop", comp: "HDD 1TB", issue: "Bad sector", sparepart: 450000, jasa: 100000 },
            { cat: "Laptop", comp: "Fan Laptop", issue: "Panas / berisik", sparepart: 120000, jasa: 100000 },
            { cat: "Laptop", comp: "Thermal Paste", issue: "Overheat", sparepart: 30000, jasa: 80000 },
            { cat: "Laptop", comp: "Engsel", issue: "Patah", sparepart: 150000, jasa: 120000 },
            { cat: "Laptop", comp: "Charger", issue: "Tidak mengisi", sparepart: 180000, jasa: 50000 },
            { cat: "PC", comp: "Motherboard", issue: "Mati total", sparepart: 700000, jasa: 150000 },
            { cat: "PC", comp: "RAM 8GB", issue: "Tidak booting", sparepart: 300000, jasa: 50000 },
            { cat: "PC", comp: "SSD 512GB", issue: "Upgrade / rusak", sparepart: 650000, jasa: 100000 },
            { cat: "PC", comp: "Power Supply", issue: "PC mati", sparepart: 400000, jasa: 120000 },
            { cat: "PC", comp: "VGA Card", issue: "No display", sparepart: 1500000, jasa: 150000 },
            { cat: "PC", comp: "CPU Cooler", issue: "Overheat", sparepart: 150000, jasa: 80000 },
            { cat: "PC", comp: "Fan Case", issue: "Sirkulasi udara", sparepart: 50000, jasa: 50000 },
            { cat: "Kulkas", comp: "Thermostat", issue: "Tidak dingin", sparepart: 150000, jasa: 120000 },
            { cat: "Kulkas", comp: "Timer Defrost", issue: "Bunga es", sparepart: 180000, jasa: 120000 },
            { cat: "Kulkas", comp: "Fan Motor", issue: "Tidak dingin merata", sparepart: 200000, jasa: 150000 },
            { cat: "Kulkas", comp: "Kapasitor", issue: "Mesin tidak start", sparepart: 70000, jasa: 100000 },
            { cat: "Kulkas", comp: "Relay", issue: "Kompresor mati", sparepart: 90000, jasa: 120000 },
            { cat: "Kulkas", comp: "Karet Pintu", issue: "Bocor dingin", sparepart: 80000, jasa: 80000 },
            { cat: "Kulkas", comp: "Kompresor", issue: "Mati total", sparepart: 900000, jasa: 300000 },
            { cat: "Mesin Cuci", comp: "Dinamo", issue: "Tidak berputar", sparepart: 450000, jasa: 200000 },
            { cat: "Mesin Cuci", comp: "Kapasitor", issue: "Putaran lemah", sparepart: 70000, jasa: 100000 },
            { cat: "Mesin Cuci", comp: "Timer", issue: "Tidak jalan", sparepart: 120000, jasa: 120000 },
            { cat: "Mesin Cuci", comp: "Vanbelt", issue: "Putus", sparepart: 50000, jasa: 80000 },
            { cat: "Mesin Cuci", comp: "Gearbox", issue: "Suara kasar", sparepart: 350000, jasa: 180000 },
            { cat: "Mesin Cuci", comp: "Seal Tabung", issue: "Bocor", sparepart: 90000, jasa: 150000 },
            { cat: "Mesin Cuci", comp: "Pompa Air", issue: "Tidak buang air", sparepart: 150000, jasa: 150000 },
            { cat: "TV", comp: "LED Backlight", issue: "Gelap", sparepart: 300000, jasa: 150000 },
            { cat: "TV", comp: "Power Supply Board", issue: "Tidak nyala", sparepart: 350000, jasa: 150000 },
            { cat: "TV", comp: "Mainboard", issue: "No signal", sparepart: 600000, jasa: 180000 },
            { cat: "TV", comp: "T-Con Board", issue: "Garis layar", sparepart: 250000, jasa: 150000 },
            { cat: "TV", comp: "Speaker TV", issue: "Suara pecah", sparepart: 80000, jasa: 80000 },
            { cat: "TV", comp: "Panel LCD", issue: "Retak", sparepart: 1200000, jasa: 250000 },
            { cat: "Kipas Angin", comp: "Dinamo", issue: "Tidak berputar", sparepart: 180000, jasa: 80000 },
            { cat: "Kipas Angin", comp: "Kapasitor", issue: "Putaran lemah", sparepart: 40000, jasa: 50000 },
            { cat: "Kipas Angin", comp: "Baling-baling", issue: "Patah", sparepart: 50000, jasa: 50000 },
            { cat: "Kipas Angin", comp: "Switch", issue: "Tidak bisa pindah speed", sparepart: 30000, jasa: 50000 },
            { cat: "Kipas Angin", comp: "Bearing", issue: "Berisik", sparepart: 40000, jasa: 60000 },
            { cat: "Jasa Servis", comp: "Cek & Diagnosa", issue: "Semua perangkat", sparepart: 0, jasa: 50000 },
            { cat: "Jasa Servis", comp: "Cleaning Dalam", issue: "HP / Laptop / PC", sparepart: 0, jasa: 80000 },
            { cat: "Jasa Servis", comp: "Install OS", issue: "Laptop / PC", sparepart: 0, jasa: 100000 },
            { cat: "Jasa Servis", comp: "Flushing Kulkas", issue: "Kulkas tidak dingin", sparepart: 0, jasa: 250000 },
            { cat: "Jasa Servis", comp: "Servis Dinamo", issue: "Mesin Cuci / Kipas", sparepart: 0, jasa: 150000 },
            { cat: "HP", comp: "IC Charging", issue: "Tidak bisa isi daya", sparepart: 120000, jasa: 120000 },
            { cat: "HP", comp: "IC Audio", issue: "Suara mati", sparepart: 100000, jasa: 120000 },
            { cat: "HP", comp: "IC RF", issue: "Sinyal hilang", sparepart: 150000, jasa: 150000 },
            { cat: "HP", comp: "Antena Signal", issue: "Sinyal lemah", sparepart: 30000, jasa: 50000 },
            { cat: "HP", comp: "SIM Tray", issue: "SIM tidak terbaca", sparepart: 20000, jasa: 30000 },
            { cat: "HP", comp: "Vibrator", issue: "Getar tidak jalan", sparepart: 25000, jasa: 40000 },
            { cat: "HP", comp: "Back Cover", issue: "Cover pecah", sparepart: 50000, jasa: 30000 },
            { cat: "HP", comp: "Proximity Sensor", issue: "Layar mati saat telpon", sparepart: 40000, jasa: 60000 },
            { cat: "HP", comp: "Gyro Sensor", issue: "Auto rotate error", sparepart: 60000, jasa: 70000 },
            { cat: "HP", comp: "Face ID / Fingerprint", issue: "Tidak terbaca", sparepart: 120000, jasa: 80000 },
            { cat: "HP", comp: "Camera Flex", issue: "Kamera tidak terdeteksi", sparepart: 60000, jasa: 60000 },
            { cat: "HP", comp: "Loudspeaker", issue: "Bunyi pecah", sparepart: 70000, jasa: 50000 },
            { cat: "HP", comp: "IC Display", issue: "Layar blank", sparepart: 200000, jasa: 180000 },
            { cat: "HP", comp: "Flash HP Normal", issue: "Error sistem", sparepart: 0, jasa: 50000 },
            { cat: "HP", comp: "Flash HP + FRP", issue: "Lupa akun Google", sparepart: 0, jasa: 80000 },
            { cat: "HP", comp: "Flash HP Deadboot", issue: "Mati software", sparepart: 0, jasa: 120000 }
        ];

        // --- HELPER FUNCTIONS ---
        function formatRupiah(number) {
            return "Rp " + number.toLocaleString('id-ID');
        }

        // --- NAVIGATION & LOGIC ---
        function showSection(id) {
            document.querySelectorAll('.step-section').forEach(sec => sec.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            window.scrollTo(0,0);
        }

        function showLogin() { showSection('login-section'); }
        function goToCustomerView() { 
            showSection('customer-hero'); 
            document.getElementById('custCategory').value = "";
            document.getElementById('custService').innerHTML = '<option value="">-- Pilih Kerusakan --</option>';
            document.getElementById('priceDisplay').style.display = 'none';
            document.getElementById('pickupInputGroup').style.display = 'none';
            document.getElementById('needPickup').checked = false;
            document.getElementById('custName').value = '';
            document.getElementById('custWA').value = '';
            document.getElementById('custAddress').value = '';
        }
        function startCustomerOrder() { 
            showSection('customer-form'); 
            populateCategories(); 
        }
        function showArticle() {
            showSection('article-section');
        }
        // Quick Select Service
        function selectQuickService(cat, issue) {
            startCustomerOrder();
            document.getElementById('custCategory').value = cat;
            populateServiceDropdown();
            // Try to find matching issue in dropdown
            const servSelect = document.getElementById('custService');
            for(let i=0; i<servSelect.options.length; i++) {
                if(servSelect.options[i].text.includes(issue)) {
                    servSelect.selectedIndex = i;
                    break;
                }
            }
            updatePriceSummary();
        }

        // --- DATABASE LOGIC ---
        
        function populateCategories() {
            const catSelect = document.getElementById('custCategory');
            const categories = [...new Set(serviceDatabase.map(item => item.cat))];
            
            while (catSelect.options.length > 1) {
                catSelect.remove(1);
            }

            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                catSelect.appendChild(option);
            });
        }

        function populateServiceDropdown() {
            const selectedCat = document.getElementById('custCategory').value;
            const servSelect = document.getElementById('custService');
            const priceDisplay = document.getElementById('priceDisplay');

            servSelect.innerHTML = '<option value="">-- Pilih Kerusakan --</option>';
            priceDisplay.style.display = 'none';

            if (!selectedCat) return;

            const filteredServices = serviceDatabase.filter(item => item.cat === selectedCat);

            filteredServices.forEach(item => {
                const option = document.createElement('option');
                option.value = JSON.stringify(item); 
                option.textContent = `${item.comp} - ${item.issue}`;
                servSelect.appendChild(option);
            });
        }

        // --- PICKUP LOGIC (BARU) ---
        function togglePickupInput() {
            const isChecked = document.getElementById('needPickup').checked;
            const group = document.getElementById('pickupInputGroup');
            if(isChecked) {
                group.style.display = 'block';
            } else {
                group.style.display = 'none';
            }
            updatePriceSummary();
        }

        function calculatePickupFee() {
            if(!document.getElementById('needPickup').checked) return 0;
            const dist = parseFloat(document.getElementById('pickupDistance').value) || 0;
            if(dist > 0 && dist < 5) return 25000;
            if(dist >= 5) return 9999999; // Flag high number for Admin Contact logic
            return 0;
        }

        function updatePriceSummary() {
            const servSelect = document.getElementById('custService');
            const priceDisplay = document.getElementById('priceDisplay');
            const pickupRow = document.getElementById('pickupRow');
            
            if (servSelect.value === "") {
                priceDisplay.style.display = 'none';
                return;
            }

            const data = JSON.parse(servSelect.value);
            let serviceTotal = data.sparepart + data.jasa;
            let pickupFee = calculatePickupFee();
            let pickupText = "Rp 0";
            let showPickup = false;

            if(pickupFee === 25000) {
                pickupText = "Rp 25.000";
                showPickup = true;
            } else if(pickupFee > 100000) {
                pickupText = "Hubungi Admin (>5km)";
                showPickup = true;
                serviceTotal = "Hubungi Admin"; // Override total display text
            }

            const finalTotalDisplay = (typeof serviceTotal === 'number') ? serviceTotal + (pickupFee > 0 && pickupFee < 100000 ? pickupFee : 0) : serviceTotal;

            document.getElementById('dispSparepart').textContent = formatRupiah(data.sparepart);
            document.getElementById('dispService').textContent = formatRupiah(data.jasa);
            document.getElementById('dispPickup').textContent = pickupText;
            document.getElementById('pickupFeeText').textContent = pickupText === "Hubungi Admin (>5km)" ? pickupText : `Biaya Pickup: ${pickupText}`;

            if(showPickup) {
                pickupRow.style.display = 'flex';
            } else {
                pickupRow.style.display = 'none';
            }

            document.getElementById('dispTotal').textContent = (typeof finalTotalDisplay === 'number') ? formatRupiah(finalTotalDisplay) : finalTotalDisplay;
            priceDisplay.style.display = 'block';
        }

        // --- WA SENDING & SPREADSHEET LOGIC ---
        async function sendCustomerOrder(event) {
            if(event) event.preventDefault();

            const btn = document.getElementById('btnSendWA');
            const originalBtnContent = btn.innerHTML;

            const name = document.getElementById('custName').value;
            const wa = document.getElementById('custWA').value;
            const address = document.getElementById('custAddress').value;

            if (!name || !wa) {
                showToast("Nama dan Nomor WA wajib diisi!");
                return;
            }

            const servSelect = document.getElementById('custService');
            let messageBody = "";
            let serviceData = {
                cat: "-",
                comp: "-",
                issue: "Konsultasi Umum",
                total: "0"
            };

            if (servSelect.value !== "") {
                const data = JSON.parse(servSelect.value);
                const pickupFee = calculatePickupFee();
                const isPickup = document.getElementById('needPickup').checked;
                const dist = document.getElementById('pickupDistance').value;

                let total = data.sparepart + data.jasa;
                let pickupInfo = "";
                if(isPickup) {
                    if(pickupFee === 25000) {
                        total += pickupFee;
                        pickupInfo = `\n\n*PICKUP & ANTAR*\nJarak: ${dist} km\nBiaya Jemput: +Rp 25.000`;
                    } else if (pickupFee > 100000) {
                        pickupInfo = `\n\n*PICKUP & ANTAR*\nJarak: ${dist} km\n(Need Admin Quote karena > 5km)`;
                    }
                }

                serviceData = {
                    cat: data.cat,
                    comp: data.comp,
                    issue: data.issue,
                    total: total
                };

                messageBody =
`Halo Admin, saya ingin order servis.

DETAIL KERUSAKAN:
Kategori: ${data.cat}
Komponen: ${data.comp}
Masalah: ${data.issue}

ESTIMASI BIAYA:
Sparepart: ${formatRupiah(data.sparepart)}
Jasa: ${formatRupiah(data.jasa)}
TOTAL: ${formatRupiah(total)}${pickupInfo}

DATA PELANGGAN:
Nama: ${name}
No WA: ${wa}
Alamat: ${address}`;
            } else {
                messageBody =
`Halo Admin, saya ingin konsultasi servis.

Nama: ${name}
No WA: ${wa}
Alamat: ${address}`;
            }

            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Menyimpan Data...';

            const payload = {
                name: name,
                wa: wa,
                address: address,
                cat: serviceData.cat,
                comp: serviceData.comp,
                issue: serviceData.issue,
                total: serviceData.total
            };

            try {
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error("Gagal koneksi ke database");

                const result = await response.json();
                showToast("Data berhasil disimpan!", true);
                setTimeout(() => {
                    openWhatsApp("6285713087659", messageBody);
                }, 1000);

            } catch (error) {
                console.error("Error:", error);
                showToast("Gagal simpan ke Database, tapi tetap kirim ke WA.", false);
                setTimeout(() => {
                    openWhatsApp("6285713087659", messageBody);
                }, 1500);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalBtnContent;
            }
        }

        // --- LOGIN & SECURITY LOGIC ---
        async function handleLogin() {
            const user = document.getElementById('adminUser').value.trim();
            const pass = document.getElementById('adminPass').value.trim();
            const btn = document.getElementById('btnLogin');

            if (!user || !pass) {
                showToast("Username dan Password wajib diisi!");
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Mengecek Data...';

            try {
                const response = await fetch(SPREADSHEET_URL);
                if (!response.ok) throw new Error("Gagal mengambil data");
                
                const csvData = await response.text();
                const isValid = validateCredentials(csvData, user, pass);

                if (isValid) {
                    showToast("Login Berhasil", true);
                    document.getElementById('resDate').valueAsDate = new Date();
                    document.getElementById('resOrderId').value = generateOrderId();
                    updateLivePreview();
                    showSection('admin-panel');
                } else {
                    showToast("Username atau Password salah!");
                }

            } catch (error) {
                console.error(error);
                showToast("Gagal koneksi ke server login.");
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span>Masuk Panel Admin</span>';
            }
        }

        function generateOrderId() {
            const now = new Date();
            const yyyy = now.getFullYear();
            const mm = String(now.getMonth() + 1).padStart(2, '0');
            const dd = String(now.getDate()).padStart(2, '0');
            const hh = String(now.getHours()).padStart(2, '0');
            const min = String(now.getMinutes()).padStart(2, '0');
            const ss = String(now.getSeconds()).padStart(2, '0');
            return `ORD-${yyyy}${mm}${dd}-${hh}${min}${ss}`;
        }

        function validateCredentials(csvText, inputUser, inputPass) {
            const rows = csvText.split('\n');
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i].trim();
                if (!row) continue;

                const cols = row.split(',');
                
                if (cols.length >= 2) {
                    const dbUser = cols[0].trim();
                    const dbPass = cols[1].trim();

                    if (dbUser === inputUser && dbPass === inputPass) {
                        return true;
                    }
                }
            }
            return false;
        }

        function logout() {
            document.getElementById('adminUser').value = '';
            document.getElementById('adminPass').value = '';
            showSection('login-section');
            showToast("Anda telah keluar", true);
        }

        function showToast(msg, isSuccess = false) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.style.background = isSuccess ? '#10b981' : '#ef4444';
            toast.style.display = 'block';
            setTimeout(() => { toast.style.display = 'none'; }, 4000);
        }

        function updateLivePreview() {
            const id = document.getElementById('resOrderId').value || '-';
            const date = document.getElementById('resDate').value || '-';
            const name = document.getElementById('resName').value || '-';
            const wa = document.getElementById('resWA').value || '-';
            const dev = document.getElementById('resDevice').value || '-';
            const model = document.getElementById('resModel').value || '-';
            const issue = document.getElementById('resIssue').value || '-';
            const servicesRaw = document.getElementById('resServices').value;

            document.getElementById('prevId').innerText = id;
            document.getElementById('prevDate').innerText = date;
            document.getElementById('prevName').innerText = name;
            document.getElementById('prevWA').innerText = wa;
            document.getElementById('prevDevice').innerText = dev;
            document.getElementById('prevModel').innerText = model;
            document.getElementById('prevIssue').innerText = issue;

            const container = document.getElementById('prevServices');
            container.innerHTML = '';
            let total = 0;
            
            if (servicesRaw.trim() !== '') {
                const lines = servicesRaw.split('\n');
                lines.forEach(line => {
                    if(line.trim() !== '') {
                        const parts = line.split('-');
                        let serviceName = line;
                        let price = 0;
                        let priceStr = '';

                        if (parts.length >= 2) {
                            serviceName = parts.slice(0, -1).join('-').trim();
                            const priceVal = parts[parts.length - 1].replace(/\D/g, '');
                            price = parseInt(priceVal) || 0;
                            priceStr = `Rp ${price.toLocaleString('id-ID')}`;
                        }

                        total += price;

                        const div = document.createElement('div');
                        div.className = 'receipt-row';
                        div.innerHTML = `<span>${serviceName}</span><span>${priceStr}</span>`;
                        container.appendChild(div);
                    }
                });
            } else {
                container.innerHTML = '<div style="font-size:0.8rem; text-align:center;">Belum ada data</div>';
            }

            document.getElementById('prevTotal').innerText = `Rp ${total.toLocaleString('id-ID')}`;
        }

        function printReceipt() {
            const id = document.getElementById('resOrderId').value;
            if(!id) { showToast('Nomor Order wajib diisi!'); return; }
            window.print();
        }

        function downloadReceiptImage() {
            const id = document.getElementById("resOrderId").value;
            const btn = document.getElementById("btnDownload");
            
            if (!id) {
                showToast("Nomor Order wajib diisi!");
                return;
            }

            const element = document.getElementById("receiptPreview");
            const originalText = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Memproses...';

            // Scale 2 for sharpness on mobile
            html2canvas(element, { 
                scale: 2, 
                backgroundColor: "#ffffff",
                useCORS: true 
            }).then(canvas => {
                // Convert to Blob for better Android download handling
                canvas.toBlob(function(blob) {
                    if (!blob) {
                        showToast("Gagal membuat gambar (Browser error).");
                        btn.disabled = false;
                        btn.innerHTML = originalText;
                        return;
                    }

                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `Resi-${id.replace(/[^a-zA-Z0-9]/g, '')}.jpg`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    setTimeout(() => {
                        URL.revokeObjectURL(url);
                        showToast("Sedang mengunduh file...", true);
                        btn.disabled = false;
                        btn.innerHTML = originalText;
                    }, 100);

                }, 'image/jpeg', 0.95);

            }).catch(err => {
                console.error(err);
                showToast("Terjadi kesalahan saat render gambar.");
                btn.disabled = false;
                btn.innerHTML = originalText;
            });
        }

        // New: Copy Receipt Text as Fallback
        function copyReceiptText() {
            const name = document.getElementById('resName').value || '-';
            const device = document.getElementById('resDevice').value || '-';
            const issue = document.getElementById('resIssue').value || '-';
            const services = document.getElementById('resServices').value || '-';
            const price = document.getElementById('prevTotal').innerText;

            const text = `RESI MALIK SERVICE\n\nNama: ${name}\nPerangkat: ${device}\nMasalah: ${issue}\n\nRincian:\n${services}\n\nTOTAL: ${price}\n\nTerima Kasih.`;

            navigator.clipboard.writeText(text).then(() => {
                showToast("Teks Resi berhasil disalin!");
            }).catch(err => {
                showToast("Gagal menyalin teks.");
            });
        }

        function openWhatsApp(number, message) {
            const encoded = encodeURIComponent(message);
            const url = `https://wa.me/${number}?text=${encoded}`;
            window.location.href = url;
        }

        document.getElementById('darkModeBtn').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
        });

        // Init
        updateLivePreview();
    </script>
</body>
</html>

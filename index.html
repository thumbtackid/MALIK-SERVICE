<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malik Service Center - Admin Dashboard</title>
    
    <!-- Icons & Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* ==================== VARIABLES ==================== */
        :root {
            --primary: #1e3a8a;
            --primary-light: #3b82f6;
            --secondary: #10b981;
            --accent: #f59e0b;
            --danger: #ef4444;
            --warning: #fbbf24;
            --dark-bg: #0f172a;
            --dark-card: #1e293b;
            --light-bg: #f1f5f9;
            --light-card: #ffffff;
            --text-main: #334155;
            --text-light: #64748b;
            --border: #e2e8f0;
            --sidebar-width: 260px;
            --header-height: 70px;
            --radius: 10px;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        .dark-mode {
            --light-bg: #0f172a;
            --light-card: #1e293b;
            --text-main: #f1f5f9;
            --text-light: #94a3b8;
            --border: #334155;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--light-bg);
            color: var(--text-main);
            line-height: 1.6;
            min-height: 100vh;
            transition: var(--transition);
        }

        /* ==================== LAYOUT ==================== */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* ==================== SIDEBAR ==================== */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--light-card);
            border-right: 1px solid var(--border);
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
        }

        .brand {
            padding: 0 20px 30px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .brand-logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .brand-text {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-menu {
            flex: 1;
            overflow-y: auto;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--text-light);
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary);
            border-left-color: var(--primary);
        }

        .nav-item i {
            width: 24px;
            margin-right: 12px;
            font-size: 1.2rem;
        }

        .nav-label {
            font-weight: 500;
        }

        .nav-badge {
            margin-left: auto;
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }

        .user-profile {
            padding: 20px;
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }

        .user-info h4 {
            font-size: 0.9rem;
            margin-bottom: 2px;
        }

        .user-info p {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* ==================== MAIN CONTENT ==================== */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 20px;
        }

        .header {
            height: var(--header-height);
            background: var(--light-card);
            border-radius: var(--radius);
            padding: 0 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        .header-left h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-main);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .header-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ==================== DASHBOARD ==================== */
        .section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ==================== STATS CARDS ==================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--light-card);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-size: 1.5rem;
        }

        .stat-content {
            flex: 1;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .stat-change {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 20px;
            margin-top: 5px;
            display: inline-block;
        }

        .stat-change.positive {
            background: rgba(16, 185, 129, 0.1);
            color: var(--secondary);
        }

        .stat-change.negative {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        /* ==================== TABLES ==================== */
        .table-container {
            background: var(--light-card);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .table-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h3 {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .table-actions {
            display: flex;
            gap: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: rgba(59, 130, 246, 0.05);
        }

        th {
            padding: 15px 20px;
            text-align: left;
            font-weight: 600;
            color: var(--text-main);
            border-bottom: 1px solid var(--border);
        }

        td {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
        }

        tr:hover {
            background: rgba(59, 130, 246, 0.02);
        }

        /* ==================== FORMS ==================== */
        .form-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .form-modal.active {
            display: flex;
        }

        .form-container {
            background: var(--light-card);
            border-radius: var(--radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        }

        .form-header {
            padding: 25px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .form-header h3 {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .form-body {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--light-bg);
            color: var(--text-main);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-footer {
            padding: 20px 25px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* ==================== BUTTONS ==================== */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-main);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            border-radius: 50%;
        }

        /* ==================== BADGES ==================== */
        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--secondary);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--accent);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .badge-info {
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary);
        }

        /* ==================== UTILITIES ==================== */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .d-flex { display: flex; }
        .d-none { display: none; }
        .align-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }
        .gap-3 { gap: 1.5rem; }
        .w-100 { width: 100%; }
        .cursor-pointer { cursor: pointer; }

        /* ==================== LOADER & TOAST ==================== */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .dark-mode .loader {
            background: rgba(15, 23, 42, 0.95);
        }

        .loader.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            background: var(--light-card);
            border-radius: var(--radius);
            padding: 15px 20px;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 9998;
            transform: translateX(400px);
            transition: var(--transition);
            max-width: 400px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .toast-success .toast-icon {
            background: var(--secondary);
            color: white;
        }

        .toast-error .toast-icon {
            background: var(--danger);
            color: white;
        }

        .toast-warning .toast-icon {
            background: var(--accent);
            color: white;
        }

        .toast-info .toast-icon {
            background: var(--primary);
            color: white;
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                transition: var(--transition);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .mobile-menu-btn {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .table-actions {
                flex-direction: column;
            }
        }

        /* ==================== LOGIN PAGE ==================== */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            padding: 20px;
        }

        .login-card {
            background: var(--light-card);
            border-radius: var(--radius);
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo .brand-logo {
            margin: 0 auto 15px;
        }

        .login-title {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-title h2 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .login-title p {
            color: var(--text-light);
        }
    </style>
</head>
<body class="dark-mode">
    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <div class="toast-icon">
            <i class="fas fa-info-circle"></i>
        </div>
        <div class="toast-content"></div>
        <button class="btn btn-icon btn-outline" onclick="hideToast()">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="login-container">
        <div class="login-card">
            <div class="login-logo">
                <div class="brand-logo">
                    <i class="fas fa-tools"></i>
                </div>
                <div class="brand-text">Malik Service</div>
            </div>
            
            <div class="login-title">
                <h2>Admin Dashboard</h2>
                <p>Sign in to continue</p>
            </div>
            
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" class="form-control" placeholder="Enter username" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Enter password" required>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="app-container" class="app-container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="brand">
                <div class="brand-logo">
                    <i class="fas fa-tools"></i>
                </div>
                <div class="brand-text">Malik Service</div>
            </div>
            
            <div class="nav-menu">
                <a href="#dashboard" class="nav-item active" onclick="showSection('dashboard')">
                    <i class="fas fa-chart-line"></i>
                    <span class="nav-label">Dashboard</span>
                </a>
                
                <a href="#services" class="nav-item" onclick="showSection('services')">
                    <i class="fas fa-wrench"></i>
                    <span class="nav-label">Layanan</span>
                </a>
                
                <a href="#orders" class="nav-item" onclick="showSection('orders')">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="nav-label">Pesanan</span>
                    <span class="nav-badge" id="pending-orders">0</span>
                </a>
                
                <a href="#manual-order" class="nav-item" onclick="showSection('manual-order')">
                    <i class="fas fa-edit"></i>
                    <span class="nav-label">Buat Order Manual</span>
                </a>
                
                <a href="#discounts" class="nav-item" onclick="showSection('discounts')">
                    <i class="fas fa-tag"></i>
                    <span class="nav-label">Diskon</span>
                </a>
                
                <a href="#customers" class="nav-item" onclick="showSection('customers')">
                    <i class="fas fa-users"></i>
                    <span class="nav-label">Pelanggan</span>
                </a>
                
                <a href="#reports" class="nav-item" onclick="showSection('reports')">
                    <i class="fas fa-chart-bar"></i>
                    <span class="nav-label">Laporan</span>
                </a>
                
                <a href="#settings" class="nav-item" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i>
                    <span class="nav-label">Pengaturan</span>
                </a>
            </div>
            
            <div class="user-profile">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-info">
                    <h4 id="user-name">Administrator</h4>
                    <p id="user-role">Super Admin</p>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <h1 id="page-title">Dashboard</h1>
                </div>
                
                <div class="header-right">
                    <button class="header-btn" onclick="toggleTheme()" title="Toggle Theme">
                        <i class="fas fa-moon"></i>
                    </button>
                    
                    <div style="position: relative;">
                        <button class="header-btn" onclick="showNotifications()" title="Notifications">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">3</span>
                        </button>
                    </div>
                    
                    <button class="header-btn" onclick="logout()" title="Logout">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>

            <!-- Dashboard Section -->
            <section id="dashboard-section" class="section active">
                <!-- Stats Cards -->
                <div class="stats-grid" id="stats-cards">
                    <!-- Loaded by JavaScript -->
                </div>

                <!-- Recent Orders -->
                <div class="table-container">
                    <div class="table-header">
                        <h3>Pesanan Terbaru</h3>
                        <div class="table-actions">
                            <button class="btn btn-outline btn-sm" onclick="refreshOrders()">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table id="recent-orders-table">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Pelanggan</th>
                                    <th>Layanan</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Tanggal</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Loaded by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Services Section -->
            <section id="services-section" class="section">
                <div class="table-container">
                    <div class="table-header">
                        <h3>Daftar Layanan</h3>
                        <div class="table-actions">
                            <button class="btn btn-primary btn-sm" onclick="showServiceForm()">
                                <i class="fas fa-plus"></i> Tambah Layanan
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="refreshServices()">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table id="services-table">
                            <thead>
                                <tr>
                                    <th>Kategori</th>
                                    <th>Tipe</th>
                                    <th>Nama Layanan</th>
                                    <th>Harga Dasar</th>
                                    <th>Harga Jual</th>
                                    <th>Estimasi</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Loaded by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Orders Section -->
            <section id="orders-section" class="section">
                <div class="table-container">
                    <div class="table-header">
                        <h3>Semua Pesanan</h3>
                        <div class="table-actions">
                            <select id="order-filter" class="form-control" style="width: 150px;" onchange="filterOrders()">
                                <option value="">Semua Status</option>
                                <option value="Pending">Pending</option>
                                <option value="Diproses">Diproses</option>
                                <option value="Selesai">Selesai</option>
                                <option value="Dibatalkan">Dibatalkan</option>
                            </select>
                            <button class="btn btn-outline btn-sm" onclick="refreshOrders()">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table id="orders-table">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Pelanggan</th>
                                    <th>WhatsApp</th>
                                    <th>Layanan</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Pembayaran</th>
                                    <th>Tanggal</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Loaded by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Manual Order Section -->
            <section id="manual-order-section" class="section">
                <div class="table-container">
                    <div class="table-header">
                        <h3>Buat Order Manual</h3>
                    </div>
                    <div class="form-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nama Pelanggan *</label>
                                <input type="text" id="manual-customer-name" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label>Nomor WhatsApp *</label>
                                <input type="tel" id="manual-customer-phone" class="form-control" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Alamat</label>
                            <textarea id="manual-customer-address" class="form-control" rows="2"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Layanan (Format: Nama Layanan - Harga)</label>
                            <textarea id="manual-services" class="form-control" rows="5" 
                                      placeholder="Contoh:
1. Service Laptop - Rp 150.000
2. Ganti LCD HP - Rp 350.000
3. Install Windows - Rp 100.000"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Kategori</label>
                                <select id="manual-category" class="form-control">
                                    <option value="Manual">Manual</option>
                                    <option value="ANDROID">Android</option>
                                    <option value="LAPTOP">Laptop</option>
                                    <option value="PC">PC</option>
                                    <option value="PRINTER">Printer</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Diskon (Rp)</label>
                                <input type="number" id="manual-discount" class="form-control" value="0" min="0">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Biaya Tambahan (Rp)</label>
                                <input type="number" id="manual-additional-fees" class="form-control" value="0" min="0">
                            </div>
                            <div class="form-group">
                                <label>Status Awal</label>
                                <select id="manual-status" class="form-control">
                                    <option value="Pending">Pending</option>
                                    <option value="Diproses">Diproses</option>
                                    <option value="Selesai">Selesai</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Catatan</label>
                            <textarea id="manual-notes" class="form-control" rows="3"></textarea>
                        </div>
                        
                        <div class="form-footer">
                            <button type="button" class="btn btn-outline" onclick="calculateManualTotal()">
                                <i class="fas fa-calculator"></i> Hitung Total
                            </button>
                            <button type="button" class="btn btn-primary" onclick="submitManualOrder()">
                                <i class="fas fa-save"></i> Simpan Order
                            </button>
                        </div>
                        
                        <div id="manual-total-display" class="mt-3" style="display: none;">
                            <h4>Rincian Order:</h4>
                            <div id="manual-summary"></div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Service Form Modal -->
    <div id="service-form-modal" class="form-modal">
        <div class="form-container">
            <div class="form-header">
                <h3 id="service-form-title">Tambah Layanan Baru</h3>
                <button class="btn btn-icon btn-outline" onclick="hideServiceForm()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="form-body">
                <form id="service-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Kategori *</label>
                            <select id="service-category" class="form-control" required>
                                <option value="">Pilih Kategori</option>
                                <option value="ANDROID">Android</option>
                                <option value="LAPTOP">Laptop</option>
                                <option value="PC">PC</option>
                                <option value="PRINTER">Printer</option>
                                <option value="TV">TV</option>
                                <option value="MONITOR">Monitor</option>
                                <option value="CCTV">CCTV</option>
                                <option value="CONSOLE">Console</option>
                                <option value="KULKAS">Kulkas</option>
                                <option value="AC">AC</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Tipe Masalah *</label>
                            <select id="service-type" class="form-control" required>
                                <option value="">Pilih Tipe</option>
                                <option value="Ringan">Ringan</option>
                                <option value="Sedang">Sedang</option>
                                <option value="Berat">Berat</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Nama Layanan *</label>
                        <input type="text" id="service-name" class="form-control" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Jenis Biaya</label>
                            <select id="service-cost-type" class="form-control">
                                <option value="Sparepart + Jasa">Sparepart + Jasa</option>
                                <option value="Jasa">Jasa</option>
                                <option value="Sparepart">Sparepart</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Estimasi Waktu</label>
                            <input type="text" id="service-estimate" class="form-control" value="1-2 Jam">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Harga Dasar (Rp)</label>
                            <input type="number" id="service-base-price" class="form-control" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Harga Jual (Rp) *</label>
                            <input type="number" id="service-sell-price" class="form-control" min="0" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Deskripsi</label>
                        <textarea id="service-description" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Status</label>
                        <select id="service-status" class="form-control">
                            <option value="active">Aktif</option>
                            <option value="inactive">Nonaktif</option>
                        </select>
                    </div>
                    
                    <input type="hidden" id="service-id">
                </form>
            </div>
            
            <div class="form-footer">
                <button type="button" class="btn btn-outline" onclick="hideServiceForm()">Batal</button>
                <button type="button" class="btn btn-primary" onclick="saveService()">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Order Detail Modal -->
    <div id="order-detail-modal" class="form-modal">
        <div class="form-container">
            <div class="form-header">
                <h3>Detail Order</h3>
                <button class="btn btn-icon btn-outline" onclick="hideOrderDetail()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="form-body" id="order-detail-content">
                <!-- Loaded by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // ==================== CONFIGURATION ====================
        const CONFIG = {
            BACKEND_URL: "https://script.google.com/macros/s/AKfycbyM-rtK77wXIh40v__Y1nB-mZGvpL20N12dioiic1jxc78uJBLx3B1l--qDtF5Ku-R2/exec",
            APP_VERSION: "4.0.0",
            TOKEN_KEY: "malik_admin_token",
            USER_KEY: "malik_admin_user"
        };

        // ==================== STATE MANAGEMENT ====================
        let state = {
            token: localStorage.getItem(CONFIG.TOKEN_KEY) || null,
            user: JSON.parse(localStorage.getItem(CONFIG.USER_KEY)) || null,
            currentSection: 'dashboard',
            services: [],
            orders: [],
            stats: null
        };

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸš€ Malik Service Admin v' + CONFIG.APP_VERSION);
            
            // Check authentication
            if (state.token && state.user) {
                showMainApp();
                loadDashboard();
            } else {
                showLoginPage();
            }
            
            // Setup event listeners
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            setupTheme();
        });

        // ==================== AUTHENTICATION ====================
        async function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                showToast('Username dan password harus diisi', 'error');
                return;
            }
            
            try {
                showLoader(true);
                
                const response = await fetch(CONFIG.BACKEND_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'login_admin',
                        username: username,
                        password: password
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    state.token = result.token;
                    state.user = result.user;
                    
                    localStorage.setItem(CONFIG.TOKEN_KEY, result.token);
                    localStorage.setItem(CONFIG.USER_KEY, JSON.stringify(result.user));
                    
                    showToast('Login berhasil!', 'success');
                    
                    setTimeout(() => {
                        showMainApp();
                        loadDashboard();
                    }, 1000);
                    
                } else {
                    showToast('Login gagal: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showToast('Error saat login', 'error');
            } finally {
                showLoader(false);
            }
        }

        function logout() {
            if (confirm('Yakin ingin logout?')) {
                state.token = null;
                state.user = null;
                localStorage.removeItem(CONFIG.TOKEN_KEY);
                localStorage.removeItem(CONFIG.USER_KEY);
                showLoginPage();
                showToast('Logout berhasil', 'info');
            }
        }

        // ==================== UI FUNCTIONS ====================
        function showLoginPage() {
            document.getElementById('login-page').style.display = 'flex';
            document.getElementById('app-container').style.display = 'none';
        }

        function showMainApp() {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('app-container').style.display = 'flex';
            
            // Update user info
            if (state.user) {
                document.getElementById('user-name').textContent = state.user.name;
                document.getElementById('user-role').textContent = state.user.role;
            }
        }

        function showSection(sectionId) {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.querySelector(`[href="#${sectionId}"]`).classList.add('active');
            
            // Update page title
            const titles = {
                'dashboard': 'Dashboard',
                'services': 'Manajemen Layanan',
                'orders': 'Manajemen Pesanan',
                'manual-order': 'Buat Order Manual',
                'discounts': 'Manajemen Diskon',
                'customers': 'Data Pelanggan',
                'reports': 'Laporan & Analitik',
                'settings': 'Pengaturan Sistem'
            };
            
            document.getElementById('page-title').textContent = titles[sectionId] || 'Dashboard';
            
            // Show section
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById(`${sectionId}-section`).classList.add('active');
            state.currentSection = sectionId;
            
            // Load section data
            switch(sectionId) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'services':
                    loadServices();
                    break;
                case 'orders':
                    loadOrders();
                    break;
            }
        }

        // ==================== LOADER & TOAST ====================
        function showLoader(show) {
            document.getElementById('loader').classList.toggle('active', show);
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const content = toast.querySelector('.toast-content');
            
            content.textContent = message;
            toast.className = `toast toast-${type} show`;
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                toast.classList.remove('show');
            }, 5000);
        }

        function hideToast() {
            document.getElementById('toast').classList.remove('show');
        }

        // ==================== THEME ====================
        function setupTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
            }
        }

        function toggleTheme() {
            const isDark = document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            
            const icon = document.querySelector('[title="Toggle Theme"] i');
            icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
        }

        // ==================== DASHBOARD ====================
        async function loadDashboard() {
            try {
                showLoader(true);
                
                const [statsRes, ordersRes] = await Promise.all([
                    fetchData('get_stats'),
                    fetchData('get_all_orders', { limit: 10 })
                ]);
                
                if (statsRes.success) {
                    state.stats = statsRes.stats;
                    renderStatsCards();
                }
                
                if (ordersRes.success) {
                    state.orders = ordersRes.data;
                    renderRecentOrders();
                    
                    // Update pending orders badge
                    const pendingCount = ordersRes.data.filter(o => o.Status === 'Pending').length;
                    document.getElementById('pending-orders').textContent = pendingCount;
                }
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
                showToast('Gagal memuat dashboard', 'error');
            } finally {
                showLoader(false);
            }
        }

        function renderStatsCards() {
            const stats = state.stats;
            if (!stats) return;
            
            const cards = [
                {
                    icon: 'fas fa-shopping-cart',
                    color: '#3b82f6',
                    value: stats.total_orders,
                    label: 'Total Pesanan',
                    change: '+12%'
                },
                {
                    icon: 'fas fa-money-bill-wave',
                    color: '#10b981',
                    value: 'Rp ' + formatNumber(stats.total_revenue),
                    label: 'Total Pendapatan',
                    change: '+8%'
                },
                {
                    icon: 'fas fa-clock',
                    color: '#f59e0b',
                    value: stats.pending_orders,
                    label: 'Menunggu Diproses',
                    change: stats.pending_orders > 5 ? 'Perlu Tindakan' : null
                },
                {
                    icon: 'fas fa-wrench',
                    color: '#8b5cf6',
                    value: stats.total_services,
                    label: 'Jumlah Layanan',
                    change: null
                }
            ];
            
            const container = document.getElementById('stats-cards');
            container.innerHTML = cards.map(card => `
                <div class="stat-card">
                    <div class="stat-icon" style="background: ${card.color}20; color: ${card.color};">
                        <i class="${card.icon}"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value">${card.value}</div>
                        <div class="stat-label">${card.label}</div>
                        ${card.change ? `
                            <div class="stat-change ${card.change.includes('+') ? 'positive' : card.change.includes('-') ? 'negative' : ''}">
                                ${card.change}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function renderRecentOrders() {
            const tbody = document.querySelector('#recent-orders-table tbody');
            const orders = state.orders.slice(0, 10);
            
            if (orders.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">Tidak ada pesanan</td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = orders.map(order => {
                const details = order.details || {};
                const services = details.items || [];
                const serviceNames = services.map(s => s.name).join(', ').substring(0, 30) + '...';
                
                return `
                    <tr>
                        <td><strong>${order.Order_ID}</strong></td>
                        <td>${order.Nama_Pelanggan}</td>
                        <td>${serviceNames}</td>
                        <td>Rp ${formatNumber(order.Total_Bayar)}</td>
                        <td><span class="badge ${getStatusBadgeClass(order.Status)}">${order.Status}</span></td>
                        <td>${new Date(order.Timestamp).toLocaleDateString('id-ID')}</td>
                        <td>
                            <button class="btn btn-sm btn-outline" onclick="viewOrderDetail('${order.Order_ID}')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ==================== SERVICES MANAGEMENT ====================
        async function loadServices() {
            try {
                showLoader(true);
                
                const response = await fetchData('get_all_services');
                if (response.success) {
                    state.services = response.data;
                    renderServicesTable();
                } else {
                    showToast('Gagal memuat layanan', 'error');
                }
            } catch (error) {
                console.error('Error loading services:', error);
                showToast('Error memuat layanan', 'error');
            } finally {
                showLoader(false);
            }
        }

        function renderServicesTable() {
            const tbody = document.querySelector('#services-table tbody');
            
            if (state.services.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center">Tidak ada layanan</td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = state.services.map(service => `
                <tr>
                    <td>${service.kategori}</td>
                    <td>${service.tipe}</td>
                    <td><strong>${service.nama}</strong></td>
                    <td>Rp ${formatNumber(service.harga_dasar)}</td>
                    <td>Rp ${formatNumber(service.harga_jual)}</td>
                    <td>${service.estimasi}</td>
                    <td>
                        <span class="badge ${service.status === 'active' ? 'badge-success' : 'badge-danger'}">
                            ${service.status === 'active' ? 'Aktif' : 'Nonaktif'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline" onclick="editService(${service.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline" onclick="deleteService(${service.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function showServiceForm(serviceId = null) {
            const modal = document.getElementById('service-form-modal');
            const title = document.getElementById('service-form-title');
            const form = document.getElementById('service-form');
            
            if (serviceId) {
                title.textContent = 'Edit Layanan';
                const service = state.services.find(s => s.id === serviceId);
                if (service) {
                    document.getElementById('service-id').value = service.id;
                    document.getElementById('service-category').value = service.kategori;
                    document.getElementById('service-type').value = service.tipe;
                    document.getElementById('service-name').value = service.nama;
                    document.getElementById('service-cost-type').value = service.jenis_biaya;
                    document.getElementById('service-estimate').value = service.estimasi;
                    document.getElementById('service-base-price').value = service.harga_dasar;
                    document.getElementById('service-sell-price').value = service.harga_jual;
                    document.getElementById('service-description').value = service.deskripsi || '';
                    document.getElementById('service-status').value = service.status;
                }
            } else {
                title.textContent = 'Tambah Layanan Baru';
                form.reset();
                document.getElementById('service-id').value = '';
            }
            
            modal.classList.add('active');
        }

        function hideServiceForm() {
            document.getElementById('service-form-modal').classList.remove('active');
        }

        async function saveService() {
            const form = document.getElementById('service-form');
            const serviceId = document.getElementById('service-id').value;
            
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const serviceData = {
                kategori: document.getElementById('service-category').value,
                tipe: document.getElementById('service-type').value,
                nama: document.getElementById('service-name').value,
                jenis_biaya: document.getElementById('service-cost-type').value,
                estimasi: document.getElementById('service-estimate').value,
                harga_dasar: document.getElementById('service-base-price').value,
                harga_jual: document.getElementById('service-sell-price').value,
                deskripsi: document.getElementById('service-description').value,
                status: document.getElementById('service-status').value
            };
            
            try {
                showLoader(true);
                
                const action = serviceId ? 'update_service' : 'add_service';
                const params = serviceId ? 
                    { id: serviceId, updates: serviceData } : 
                    { service: serviceData };
                
                const response = await fetchData(action, params);
                
                if (response.success) {
                    showToast('Layanan berhasil disimpan', 'success');
                    hideServiceForm();
                    loadServices();
                } else {
                    showToast('Gagal menyimpan: ' + response.message, 'error');
                }
            } catch (error) {
                console.error('Error saving service:', error);
                showToast('Error menyimpan layanan', 'error');
            } finally {
                showLoader(false);
            }
        }

        async function deleteService(serviceId) {
            if (!confirm('Yakin ingin menghapus layanan ini?')) return;
            
            try {
                showLoader(true);
                
                const response = await fetchData('delete_service', { id: serviceId });
                
                if (response.success) {
                    showToast('Layanan berhasil dihapus', 'success');
                    loadServices();
                } else {
                    showToast('Gagal menghapus: ' + response.message, 'error');
                }
            } catch (error) {
                console.error('Error deleting service:', error);
                showToast('Error menghapus layanan', 'error');
            } finally {
                showLoader(false);
            }
        }

        function editService(serviceId) {
            showServiceForm(serviceId);
        }

        function refreshServices() {
            loadServices();
        }

        // ==================== ORDERS MANAGEMENT ====================
        async function loadOrders() {
            try {
                showLoader(true);
                
                const filter = document.getElementById('order-filter')?.value || '';
                const params = filter ? { filter: { status: filter } } : {};
                
                const response = await fetchData('get_all_orders', params);
                if (response.success) {
                    state.orders = response.data;
                    renderOrdersTable();
                } else {
                    showToast('Gagal memuat pesanan', 'error');
                }
            } catch (error) {
                console.error('Error loading orders:', error);
                showToast('Error memuat pesanan', 'error');
            } finally {
                showLoader(false);
            }
        }

        function renderOrdersTable() {
            const tbody = document.querySelector('#orders-table tbody');
            
            if (state.orders.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center">Tidak ada pesanan</td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = state.orders.map(order => {
                const details = order.details || {};
                const services = details.items || [];
                const serviceNames = services.slice(0, 2).map(s => s.name).join(', ');
                
                return `
                    <tr>
                        <td><strong>${order.Order_ID}</strong></td>
                        <td>${order.Nama_Pelanggan}</td>
                        <td>${order.WhatsApp}</td>
                        <td>${serviceNames}${services.length > 2 ? '...' : ''}</td>
                        <td>Rp ${formatNumber(order.Total_Bayar)}</td>
                        <td><span class="badge ${getStatusBadgeClass(order.Status)}">${order.Status}</span></td>
                        <td><span class="badge ${getPaymentBadgeClass(order.Status_Bayar)}">${order.Status_Bayar}</span></td>
                        <td>${new Date(order.Timestamp).toLocaleDateString('id-ID')}</td>
                        <td>
                            <button class="btn btn-sm btn-outline" onclick="viewOrderDetail('${order.Order_ID}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline" onclick="updateOrderStatusPrompt('${order.Order_ID}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline" onclick="printReceipt('${order.Order_ID}')">
                                <i class="fas fa-print"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        async function viewOrderDetail(orderId) {
            try {
                showLoader(true);
                
                const response = await fetchData('track_order', { orderId: orderId });
                
                if (response.success) {
                    const order = response.order;
                    const modal = document.getElementById('order-detail-modal');
                    const content = document.getElementById('order-detail-content');
                    
                    const servicesHTML = order.services.map((service, index) => `
                        <div style="padding: 10px; background: #f8fafc; border-radius: 8px; margin-bottom: 10px;">
                            <div style="font-weight: 600;">${index + 1}. ${service.name}</div>
                            <div style="color: #64748b; font-size: 0.9em;">Rp ${formatNumber(service.price)}</div>
                        </div>
                    `).join('');
                    
                    content.innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <h4>Informasi Order</h4>
                            <table style="width: 100%;">
                                <tr><td style="width: 120px; padding: 5px 0;">Order ID:</td><td><strong>${order.id}</strong></td></tr>
                                <tr><td style="padding: 5px 0;">Receipt:</td><td>${order.receipt}</td></tr>
                                <tr><td style="padding: 5px 0;">Tanggal:</td><td>${order.created_date}</td></tr>
                                <tr><td style="padding: 5px 0;">Status:</td><td><span class="badge ${getStatusBadgeClass(order.status)}">${order.status}</span></td></tr>
                                <tr><td style="padding: 5px 0;">Pembayaran:</td><td><span class="badge ${getPaymentBadgeClass(order.payment_status)}">${order.payment_status}</span></td></tr>
                                <tr><td style="padding: 5px 0;">Teknisi:</td><td>${order.technician || '-'}</td></tr>
                            </table>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4>Data Pelanggan</h4>
                            <table style="width: 100%;">
                                <tr><td style="width: 120px; padding: 5px 0;">Nama:</td><td>${order.customer_name}</td></tr>
                                <tr><td style="padding: 5px 0;">WhatsApp:</td><td>${order.WhatsApp || '-'}</td></tr>
                            </table>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4>Layanan</h4>
                            ${servicesHTML}
                        </div>
                        
                        <div style="border-top: 2px solid #e2e8f0; padding-top: 15px;">
                            <div style="display: flex; justify-content: space-between; font-size: 1.2em; font-weight: 600;">
                                <span>Total:</span>
                                <span>Rp ${formatNumber(order.total)}</span>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; display: flex; gap: 10px;">
                            <button class="btn btn-primary" onclick="printReceipt('${order.id}')">
                                <i class="fas fa-print"></i> Print Receipt
                            </button>
                            <button class="btn btn-outline" onclick="hideOrderDetail()">
                                Tutup
                            </button>
                        </div>
                    `;
                    
                    modal.classList.add('active');
                } else {
                    showToast('Order tidak ditemukan', 'error');
                }
            } catch (error) {
                console.error('Error viewing order:', error);
                showToast('Error memuat detail order', 'error');
            } finally {
                showLoader(false);
            }
        }

        function hideOrderDetail() {
            document.getElementById('order-detail-modal').classList.remove('active');
        }

        function filterOrders() {
            loadOrders();
        }

        function refreshOrders() {
            loadOrders();
        }

        // ==================== MANUAL ORDER ====================
        function calculateManualTotal() {
            const servicesText = document.getElementById('manual-services').value;
            const discount = parseFloat(document.getElementById('manual-discount').value) || 0;
            const additionalFees = parseFloat(document.getElementById('manual-additional-fees').value) || 0;
            
            // Parse services from text
            const services = [];
            let subtotal = 0;
            
            const lines = servicesText.split('\n').filter(line => line.trim());
            lines.forEach(line => {
                const match = line.match(/(\d+\.)?\s*(.+?)\s*-\s*Rp?\s*([\d.,]+)/i);
                if (match) {
                    const serviceName = match[2].trim();
                    const price = parseFloat(match[3].replace(/[.,]/g, ''));
                    services.push({ name: serviceName, price: price });
                    subtotal += price;
                }
            });
            
            const total = subtotal - discount + additionalFees;
            
            const display = document.getElementById('manual-total-display');
            const summary = document.getElementById('manual-summary');
            
            summary.innerHTML = `
                <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Subtotal:</span>
                        <span>Rp ${formatNumber(subtotal)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Diskon:</span>
                        <span>- Rp ${formatNumber(discount)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Biaya Tambahan:</span>
                        <span>+ Rp ${formatNumber(additionalFees)}</span>
                    </div>
                    <hr style="margin: 10px 0;">
                    <div style="display: flex; justify-content: space-between; font-weight: 600; font-size: 1.1em;">
                        <span>Total:</span>
                        <span>Rp ${formatNumber(total)}</span>
                    </div>
                    <div style="margin-top: 15px; font-size: 0.9em; color: #64748b;">
                        ${services.length} layanan ditemukan
                    </div>
                </div>
            `;
            
            display.style.display = 'block';
        }

        async function submitManualOrder() {
            const customerName = document.getElementById('manual-customer-name').value.trim();
            const customerPhone = document.getElementById('manual-customer-phone').value.trim();
            const servicesText = document.getElementById('manual-services').value.trim();
            
            if (!customerName || !customerPhone || !servicesText) {
                showToast('Nama, WhatsApp, dan layanan harus diisi', 'error');
                return;
            }
            
            // Parse services
            const services = [];
            const lines = servicesText.split('\n').filter(line => line.trim());
            lines.forEach(line => {
                const match = line.match(/(\d+\.)?\s*(.+?)\s*-\s*Rp?\s*([\d.,]+)/i);
                if (match) {
                    const serviceName = match[2].trim();
                    const price = parseFloat(match[3].replace(/[.,]/g, ''));
                    services.push({ nama: serviceName, harga: price });
                }
            });
            
            if (services.length === 0) {
                showToast('Format layanan tidak valid', 'error');
                return;
            }
            
            const orderData = {
                customer_name: customerName,
                customer_phone: customerPhone,
                customer_address: document.getElementById('manual-customer-address').value.trim(),
                services: services,
                category: document.getElementById('manual-category').value,
                discount: document.getElementById('manual-discount').value,
                additional_fees: document.getElementById('manual-additional-fees').value,
                status: document.getElementById('manual-status').value,
                customer_notes: document.getElementById('manual-notes').value.trim()
            };
            
            try {
                showLoader(true);
                
                const response = await fetchData('create_manual_order', { orderData: orderData });
                
                if (response.success) {
                    showToast(`Order manual berhasil dibuat! ID: ${response.order_id}`, 'success');
                    
                    // Reset form
                    document.querySelector('#manual-order-section form').reset();
                    document.getElementById('manual-total-display').style.display = 'none';
                    
                    // Switch to orders section
                    showSection('orders');
                    loadOrders();
                } else {
                    showToast('Gagal membuat order: ' + response.message, 'error');
                }
            } catch (error) {
                console.error('Error creating manual order:', error);
                showToast('Error membuat order manual', 'error');
            } finally {
                showLoader(false);
            }
        }

        // ==================== UTILITY FUNCTIONS ====================
        async function fetchData(action, data = {}) {
            const payload = {
                action: action,
                token: state.token,
                ...data
            };
            
            const response = await fetch(CONFIG.BACKEND_URL, {
                method: 'POST',
                body: JSON.stringify(payload)
            });
            
            return await response.json();
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('id-ID').format(num);
        }

        function getStatusBadgeClass(status) {
            switch(status) {
                case 'Selesai': return 'badge-success';
                case 'Diproses': return 'badge-warning';
                case 'Pending': return 'badge-info';
                case 'Dibatalkan': return 'badge-danger';
                default: return 'badge-info';
            }
        }

        function getPaymentBadgeClass(status) {
            switch(status) {
                case 'Lunas': return 'badge-success';
                case 'DP_50%': return 'badge-warning';
                case 'Belum_Bayar': return 'badge-danger';
                default: return 'badge-info';
            }
        }

        async function printReceipt(orderId) {
            try {
                const response = await fetchData('print_receipt', { orderId: orderId });
                
                if (response.success) {
                    // Open receipt in new window for printing
                    const printWindow = window.open('', '_blank');
                    printWindow.document.write(response.html_receipt);
                    printWindow.document.close();
                    
                    setTimeout(() => {
                        printWindow.print();
                    }, 500);
                }
            } catch (error) {
                console.error('Error printing receipt:', error);
                showToast('Error mencetak receipt', 'error');
            }
        }

        async function updateOrderStatusPrompt(orderId) {
            const status = prompt('Masukkan status baru (Pending/Diproses/Selesai/Dibatalkan):', 'Diproses');
            
            if (status && ['Pending', 'Diproses', 'Selesai', 'Dibatalkan'].includes(status)) {
                try {
                    showLoader(true);
                    
                    const response = await fetchData('update_order_status', {
                        orderId: orderId,
                        status: status,
                        notes: 'Diubah melalui dashboard admin'
                    });
                    
                    if (response.success) {
                        showToast('Status order berhasil diupdate', 'success');
                        loadOrders();
                    } else {
                        showToast('Gagal mengupdate status', 'error');
                    }
                } catch (error) {
                    console.error('Error updating order status:', error);
                    showToast('Error mengupdate status', 'error');
                } finally {
                    showLoader(false);
                }
            }
        }

        function showNotifications() {
            // Simple notification display
            alert('Notifikasi:\n1. 3 order pending\n2. 1 order menunggu part\n3. Backup otomatis berjalan');
        }

        // ==================== GLOBAL FUNCTIONS ====================
        window.showSection = showSection;
        window.toggleTheme = toggleTheme;
        window.logout = logout;
        window.showServiceForm = showServiceForm;
        window.hideServiceForm = hideServiceForm;
        window.saveService = saveService;
        window.editService = editService;
        window.deleteService = deleteService;
        window.refreshServices = refreshServices;
        window.viewOrderDetail = viewOrderDetail;
        window.hideOrderDetail = hideOrderDetail;
        window.filterOrders = filterOrders;
        window.refreshOrders = refreshOrders;
        window.calculateManualTotal = calculateManualTotal;
        window.submitManualOrder = submitManualOrder;
        window.printReceipt = printReceipt;
        window.updateOrderStatusPrompt = updateOrderStatusPrompt;
        window.showNotifications = showNotifications;
    </script>
</body>
</html>

